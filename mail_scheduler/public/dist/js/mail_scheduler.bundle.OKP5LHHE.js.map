{
  "version": 3,
  "sources": ["../../../../../apps/mail_scheduler/mail_scheduler/public/js/mail_scheduler.bundle.js"],
  "sourcesContent": ["/**\n * Mail Scheduler - Scheduled Email Send for Frappe Mail\n *\n * This module adds \"Send Later\" functionality to Frappe Mail's compose interface.\n * It works as an addon without modifying the core mail app.\n */\n\n(function () {\n\t\"use strict\";\n\n\t// Configuration from boot\n\tconst config = frappe.boot.mail_scheduler || {\n\t\tenabled: true,\n\t\tmax_schedule_days: 30,\n\t};\n\n\tif (!config.enabled) {\n\t\treturn;\n\t}\n\n\t// Store reference to original send function\n\tlet originalSendMail = null;\n\n\t/**\n\t * Initialize mail scheduler when mail app is ready\n\t */\n\tfrappe.ready(function () {\n\t\t// Wait for mail app to load\n\t\tif (typeof frappe.mail === \"undefined\") {\n\t\t\t// Retry after a short delay\n\t\t\tsetTimeout(initMailScheduler, 1000);\n\t\t} else {\n\t\t\tinitMailScheduler();\n\t\t}\n\t});\n\n\tfunction initMailScheduler() {\n\t\tconsole.log(\"Mail Scheduler: Initializing...\");\n\n\t\t// Add CSS styles\n\t\taddStyles();\n\n\t\t// Extend compose toolbar if available\n\t\textendComposeToolbar();\n\t}\n\n\tfunction addStyles() {\n\t\tconst style = document.createElement(\"style\");\n\t\tstyle.textContent = `\n\t\t\t.mail-scheduler-dropdown {\n\t\t\t\tposition: relative;\n\t\t\t\tdisplay: inline-block;\n\t\t\t}\n\n\t\t\t.mail-scheduler-menu {\n\t\t\t\tposition: absolute;\n\t\t\t\tbottom: 100%;\n\t\t\t\tright: 0;\n\t\t\t\tbackground: var(--fg-color);\n\t\t\t\tborder: 1px solid var(--border-color);\n\t\t\t\tborder-radius: var(--border-radius-md);\n\t\t\t\tbox-shadow: var(--shadow-md);\n\t\t\t\tmin-width: 200px;\n\t\t\t\tz-index: 100;\n\t\t\t\tmargin-bottom: 4px;\n\t\t\t}\n\n\t\t\t.mail-scheduler-menu-item {\n\t\t\t\tpadding: 8px 12px;\n\t\t\t\tcursor: pointer;\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tgap: 8px;\n\t\t\t}\n\n\t\t\t.mail-scheduler-menu-item:hover {\n\t\t\t\tbackground: var(--bg-color);\n\t\t\t}\n\n\t\t\t.mail-scheduler-calendar {\n\t\t\t\tpadding: 12px;\n\t\t\t\tbackground: var(--fg-color);\n\t\t\t\tborder: 1px solid var(--border-color);\n\t\t\t\tborder-radius: var(--border-radius-md);\n\t\t\t\tbox-shadow: var(--shadow-lg);\n\t\t\t}\n\n\t\t\t.mail-scheduler-calendar-header {\n\t\t\t\tdisplay: flex;\n\t\t\t\tjustify-content: space-between;\n\t\t\t\talign-items: center;\n\t\t\t\tmargin-bottom: 12px;\n\t\t\t}\n\n\t\t\t.mail-scheduler-calendar-grid {\n\t\t\t\tdisplay: grid;\n\t\t\t\tgrid-template-columns: repeat(7, 1fr);\n\t\t\t\tgap: 2px;\n\t\t\t}\n\n\t\t\t.mail-scheduler-calendar-day {\n\t\t\t\twidth: 32px;\n\t\t\t\theight: 32px;\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tjustify-content: center;\n\t\t\t\tcursor: pointer;\n\t\t\t\tborder-radius: var(--border-radius-sm);\n\t\t\t\tfont-size: 12px;\n\t\t\t}\n\n\t\t\t.mail-scheduler-calendar-day:hover:not(.disabled) {\n\t\t\t\tbackground: var(--bg-color);\n\t\t\t}\n\n\t\t\t.mail-scheduler-calendar-day.selected {\n\t\t\t\tbackground: var(--primary);\n\t\t\t\tcolor: white;\n\t\t\t}\n\n\t\t\t.mail-scheduler-calendar-day.today {\n\t\t\t\tfont-weight: bold;\n\t\t\t\tcolor: var(--primary);\n\t\t\t}\n\n\t\t\t.mail-scheduler-calendar-day.disabled {\n\t\t\t\tcolor: var(--text-muted);\n\t\t\t\tcursor: not-allowed;\n\t\t\t}\n\n\t\t\t.mail-scheduler-time-picker {\n\t\t\t\tmargin-top: 12px;\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tgap: 8px;\n\t\t\t}\n\n\t\t\t.mail-scheduler-badge {\n\t\t\t\tdisplay: inline-flex;\n\t\t\t\talign-items: center;\n\t\t\t\tgap: 4px;\n\t\t\t\tpadding: 2px 8px;\n\t\t\t\tbackground: var(--yellow-100);\n\t\t\t\tcolor: var(--yellow-700);\n\t\t\t\tborder-radius: var(--border-radius-full);\n\t\t\t\tfont-size: 11px;\n\t\t\t}\n\t\t`;\n\t\tdocument.head.appendChild(style);\n\t}\n\n\tfunction extendComposeToolbar() {\n\t\t// This function would be called to extend the compose toolbar\n\t\t// The actual implementation depends on how the mail app exposes its components\n\n\t\t// For Vue-based mail app, we might need to use a different approach\n\t\t// such as providing a plugin or using event listeners\n\n\t\tconsole.log(\"Mail Scheduler: Ready to extend compose toolbar\");\n\n\t\t// Expose API for external use\n\t\twindow.mailScheduler = {\n\t\t\tconfig: config,\n\t\t\tscheduleEmail: scheduleEmail,\n\t\t\tcancelScheduledEmail: cancelScheduledEmail,\n\t\t\tupdateScheduledEmail: updateScheduledEmail,\n\t\t\tgetScheduledEmails: getScheduledEmails,\n\t\t};\n\t}\n\n\t/**\n\t * Schedule an email for later delivery\n\t */\n\tasync function scheduleEmail(mailData, scheduledAt) {\n\t\treturn frappe.call({\n\t\t\tmethod: \"mail_scheduler.api.mail.create_mail\",\n\t\t\targs: {\n\t\t\t\t...mailData,\n\t\t\t\tscheduled_at: scheduledAt,\n\t\t\t},\n\t\t});\n\t}\n\n\t/**\n\t * Cancel a scheduled email\n\t */\n\tasync function cancelScheduledEmail(mailQueueName) {\n\t\treturn frappe.call({\n\t\t\tmethod: \"mail_scheduler.api.mail.cancel_scheduled_mail\",\n\t\t\targs: {\n\t\t\t\tmail_queue_name: mailQueueName,\n\t\t\t},\n\t\t});\n\t}\n\n\t/**\n\t * Update scheduled time for an email\n\t */\n\tasync function updateScheduledEmail(mailQueueName, newScheduledAt) {\n\t\treturn frappe.call({\n\t\t\tmethod: \"mail_scheduler.api.mail.update_scheduled_mail\",\n\t\t\targs: {\n\t\t\t\tmail_queue_name: mailQueueName,\n\t\t\t\tnew_scheduled_at: newScheduledAt,\n\t\t\t},\n\t\t});\n\t}\n\n\t/**\n\t * Get list of scheduled emails\n\t */\n\tasync function getScheduledEmails(limit = 20, offset = 0) {\n\t\treturn frappe.call({\n\t\t\tmethod: \"mail_scheduler.api.mail.get_scheduled_mails\",\n\t\t\targs: {\n\t\t\t\tlimit: limit,\n\t\t\t\toffset: offset,\n\t\t\t},\n\t\t});\n\t}\n\n\t/**\n\t * Get maximum allowed schedule date\n\t */\n\tfunction getMaxScheduleDate() {\n\t\tconst maxDays = config.max_schedule_days || 30;\n\t\tconst maxDate = new Date();\n\t\tmaxDate.setDate(maxDate.getDate() + maxDays);\n\t\treturn maxDate;\n\t}\n\n\t/**\n\t * Format date for display\n\t */\n\tfunction formatScheduledDate(dateStr) {\n\t\tconst date = new Date(dateStr);\n\t\tconst now = new Date();\n\t\tconst tomorrow = new Date(now);\n\t\ttomorrow.setDate(tomorrow.getDate() + 1);\n\n\t\tconst timeStr = date.toLocaleTimeString([], {\n\t\t\thour: \"2-digit\",\n\t\t\tminute: \"2-digit\",\n\t\t});\n\n\t\tif (date.toDateString() === now.toDateString()) {\n\t\t\treturn `Today at ${timeStr}`;\n\t\t} else if (date.toDateString() === tomorrow.toDateString()) {\n\t\t\treturn `Tomorrow at ${timeStr}`;\n\t\t} else {\n\t\t\treturn date.toLocaleDateString([], {\n\t\t\t\tmonth: \"short\",\n\t\t\t\tday: \"numeric\",\n\t\t\t\thour: \"2-digit\",\n\t\t\t\tminute: \"2-digit\",\n\t\t\t});\n\t\t}\n\t}\n\n\t// Expose format function\n\twindow.mailScheduler = window.mailScheduler || {};\n\twindow.mailScheduler.formatScheduledDate = formatScheduledDate;\n\twindow.mailScheduler.getMaxScheduleDate = getMaxScheduleDate;\n})();\n"],
  "mappings": "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",
  "names": ["config", "originalSendMail", "initMailScheduler", "addStyles", "extendComposeToolbar", "style", "scheduleEmail", "cancelScheduledEmail", "updateScheduledEmail", "getScheduledEmails", "mailData", "scheduledAt", "__spreadProps", "__spreadValues", "mailQueueName", "newScheduledAt", "limit", "offset", "getMaxScheduleDate", "maxDays", "maxDate", "formatScheduledDate", "dateStr", "date", "now", "tomorrow", "timeStr"]
}
