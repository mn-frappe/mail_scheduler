{
  "version": 3,
  "sources": ["../../../../../apps/mail_scheduler/mail_scheduler/public/js/mail_scheduler.bundle.js"],
  "sourcesContent": ["/**\n * Mail Scheduler - Enterprise-Grade Scheduled Email Send for Frappe Mail\n *\n * This module adds \"Send Later\" functionality to Frappe Mail's compose interface.\n * It works as an addon without modifying the core mail app.\n *\n * Features:\n * - Schedule button in compose toolbar\n * - Calendar-based date/time picker\n * - Quick scheduling options (Tomorrow AM, Tomorrow PM, Monday)\n * - 12/24 hour time format toggle\n * - Scheduled emails folder in sidebar\n * - Enterprise-grade error handling and retry logic\n * - Rate limiting protection on client side\n * - Comprehensive logging and debugging\n * - Memory leak prevention\n * - XSS protection\n *\n * @version 2.0.0\n * @license AGPL-3.0\n */\n\n(function () {\n\t\"use strict\";\n\n\t// ============================================================\n\t// CONSTANTS AND CONFIGURATION\n\t// ============================================================\n\n\tconst VERSION = \"2.0.0\";\n\tconst DEBUG = true; // Set to true for verbose logging\n\n\t// Get mail_scheduler config - check window first (mail SPA), then frappe.boot (desk)\n\tconst getSchedulerConfig = () => {\n\t\t// Mail SPA sets config directly on window\n\t\tif (window.mail_scheduler) return window.mail_scheduler;\n\t\t// Frappe desk sets config in frappe.boot\n\t\tif (typeof frappe !== \"undefined\" && frappe?.boot?.mail_scheduler)\n\t\t\treturn frappe.boot.mail_scheduler;\n\t\t// Return defaults\n\t\treturn {};\n\t};\n\n\tconst schedulerConfig = getSchedulerConfig();\n\n\t// Configuration from boot with safe defaults\n\tconst config = Object.freeze({\n\t\tenabled: schedulerConfig?.enabled ?? true,\n\t\tmax_schedule_days: Math.min(\n\t\t\tMath.max(schedulerConfig?.max_schedule_days ?? 30, 1),\n\t\t\t365\n\t\t),\n\t\tmin_schedule_minutes: schedulerConfig?.min_schedule_minutes ?? 1,\n\t\tretry_attempts: 3,\n\t\tretry_delay_ms: 1000,\n\t\tapi_timeout_ms: 30000,\n\t\tdebounce_ms: 300,\n\t\ttoast_duration_ms: 5000,\n\t});\n\n\t// API endpoints (centralized for easy maintenance)\n\tconst ENDPOINTS = Object.freeze({\n\t\tCREATE_MAIL: \"mail_scheduler.api.mail.create_mail\",\n\t\tUPDATE_DRAFT: \"mail_scheduler.api.mail.update_draft_mail\",\n\t\tGET_SCHEDULED: \"mail_scheduler.api.scheduled.get_scheduled_emails\",\n\t\tCANCEL_SCHEDULED: \"mail_scheduler.api.scheduled.cancel_scheduled_email\",\n\t\tRESCHEDULE: \"mail_scheduler.api.scheduled.reschedule_email\",\n\t\t// Original endpoints we intercept\n\t\tORIGINAL_CREATE: \"mail.api.mail.create_mail\",\n\t\tORIGINAL_UPDATE: \"mail.api.mail.update_draft_mail\",\n\t});\n\n\t// Rate limiting state\n\tconst rateLimiter = {\n\t\trequests: [],\n\t\tmaxRequests: 60,\n\t\twindowMs: 60000,\n\t};\n\n\t// ============================================================\n\t// LOGGING UTILITIES\n\t// ============================================================\n\n\tconst Logger = {\n\t\t_prefix: \"[Mail Scheduler]\",\n\n\t\t_format(level, ...args) {\n\t\t\tconst timestamp = new Date().toISOString();\n\t\t\treturn [`${this._prefix} [${level}] [${timestamp}]`, ...args];\n\t\t},\n\n\t\tdebug(...args) {\n\t\t\tif (DEBUG) {\n\t\t\t\tconsole.debug(...this._format(\"DEBUG\", ...args));\n\t\t\t}\n\t\t},\n\n\t\tinfo(...args) {\n\t\t\tconsole.log(...this._format(\"INFO\", ...args));\n\t\t},\n\n\t\twarn(...args) {\n\t\t\tconsole.warn(...this._format(\"WARN\", ...args));\n\t\t},\n\n\t\terror(...args) {\n\t\t\tconsole.error(...this._format(\"ERROR\", ...args));\n\t\t},\n\n\t\t// Track errors for potential reporting\n\t\ttrackError(error, context = {}) {\n\t\t\tthis.error(\"Error tracked:\", error.message, context);\n\t\t\t// Could integrate with error tracking service here\n\t\t},\n\t};\n\n\t// ============================================================\n\t// UTILITY FUNCTIONS\n\t// ============================================================\n\n\t/**\n\t * Sanitize string to prevent XSS\n\t * @param {string} str - String to sanitize\n\t * @returns {string} Sanitized string\n\t */\n\tfunction sanitizeHTML(str) {\n\t\tif (typeof str !== \"string\") return \"\";\n\t\tconst div = document.createElement(\"div\");\n\t\tdiv.textContent = str;\n\t\treturn div.innerHTML;\n\t}\n\n\t/**\n\t * Debounce function to prevent rapid calls\n\t * @param {Function} func - Function to debounce\n\t * @param {number} wait - Milliseconds to wait\n\t * @returns {Function} Debounced function\n\t */\n\tfunction debounce(func, wait) {\n\t\tlet timeout;\n\t\treturn function executedFunction(...args) {\n\t\t\tconst later = () => {\n\t\t\t\tclearTimeout(timeout);\n\t\t\t\tfunc.apply(this, args);\n\t\t\t};\n\t\t\tclearTimeout(timeout);\n\t\t\ttimeout = setTimeout(later, wait);\n\t\t};\n\t}\n\n\t/**\n\t * Check if we're being rate limited\n\t * @returns {boolean} True if rate limited\n\t */\n\tfunction isRateLimited() {\n\t\tconst now = Date.now();\n\t\t// Clean old requests\n\t\trateLimiter.requests = rateLimiter.requests.filter(\n\t\t\t(time) => now - time < rateLimiter.windowMs\n\t\t);\n\t\treturn rateLimiter.requests.length >= rateLimiter.maxRequests;\n\t}\n\n\t/**\n\t * Record a request for rate limiting\n\t */\n\tfunction recordRequest() {\n\t\trateLimiter.requests.push(Date.now());\n\t}\n\n\t/**\n\t * Validate date is within allowed range\n\t * @param {Date} date - Date to validate\n\t * @returns {Object} Validation result with isValid and error\n\t */\n\tfunction validateScheduleDate(date) {\n\t\tif (!(date instanceof Date) || isNaN(date.getTime())) {\n\t\t\treturn { isValid: false, error: \"Invalid date provided\" };\n\t\t}\n\n\t\tconst now = new Date();\n\t\tconst minTime = new Date(now.getTime() + config.min_schedule_minutes * 60 * 1000);\n\t\tconst maxTime = new Date(now.getTime() + config.max_schedule_days * 24 * 60 * 60 * 1000);\n\n\t\tif (date < minTime) {\n\t\t\treturn {\n\t\t\t\tisValid: false,\n\t\t\t\terror: `Schedule time must be at least ${config.min_schedule_minutes} minute(s) in the future`,\n\t\t\t};\n\t\t}\n\n\t\tif (date > maxTime) {\n\t\t\treturn {\n\t\t\t\tisValid: false,\n\t\t\t\terror: `Cannot schedule more than ${config.max_schedule_days} days in the future`,\n\t\t\t};\n\t\t}\n\n\t\treturn { isValid: true, error: null };\n\t}\n\n\t/**\n\t * Retry a function with exponential backoff\n\t * @param {Function} fn - Async function to retry\n\t * @param {number} maxAttempts - Maximum retry attempts\n\t * @param {number} delayMs - Base delay in milliseconds\n\t * @returns {Promise} Result of the function\n\t */\n\tasync function retryWithBackoff(fn, maxAttempts = config.retry_attempts, delayMs = config.retry_delay_ms) {\n\t\tlet lastError;\n\n\t\tfor (let attempt = 1; attempt <= maxAttempts; attempt++) {\n\t\t\ttry {\n\t\t\t\treturn await fn();\n\t\t\t} catch (error) {\n\t\t\t\tlastError = error;\n\t\t\t\tLogger.warn(`Attempt ${attempt}/${maxAttempts} failed:`, error.message);\n\n\t\t\t\tif (attempt < maxAttempts) {\n\t\t\t\t\tconst backoffDelay = delayMs * Math.pow(2, attempt - 1);\n\t\t\t\t\tLogger.debug(`Retrying in ${backoffDelay}ms...`);\n\t\t\t\t\tawait new Promise((resolve) => setTimeout(resolve, backoffDelay));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthrow lastError;\n\t}\n\n\t/**\n\t * Format a date for display\n\t * @param {Date|string} date - Date to format\n\t * @returns {string} Formatted date string\n\t */\n\tfunction formatScheduledDate(date) {\n\t\ttry {\n\t\t\tconst d = date instanceof Date ? date : new Date(date);\n\t\t\tif (isNaN(d.getTime())) {\n\t\t\t\treturn \"Invalid date\";\n\t\t\t}\n\t\t\treturn d.toLocaleString(\"en-US\", {\n\t\t\t\tweekday: \"short\",\n\t\t\t\tmonth: \"short\",\n\t\t\t\tday: \"numeric\",\n\t\t\t\thour: \"numeric\",\n\t\t\t\tminute: \"2-digit\",\n\t\t\t});\n\t\t} catch (e) {\n\t\t\tLogger.error(\"Error formatting date:\", e);\n\t\t\treturn \"Unknown\";\n\t\t}\n\t}\n\n\t/**\n\t * Get relative time description\n\t * @param {Date} date - Target date\n\t * @returns {string} Relative time string\n\t */\n\tfunction getRelativeTime(date) {\n\t\tconst now = new Date();\n\t\tconst diff = date - now;\n\n\t\tif (diff < 0) {\n\t\t\treturn \"Time is in the past\";\n\t\t}\n\n\t\tconst minutes = Math.floor(diff / (1000 * 60));\n\t\tconst hours = Math.floor(diff / (1000 * 60 * 60));\n\t\tconst days = Math.floor(diff / (1000 * 60 * 60 * 24));\n\n\t\tif (days > 0) {\n\t\t\treturn `in ${days} day${days > 1 ? \"s\" : \"\"}`;\n\t\t} else if (hours > 0) {\n\t\t\tconst remainingMinutes = minutes % 60;\n\t\t\treturn `in ${hours} hour${hours > 1 ? \"s\" : \"\"} and ${remainingMinutes} minute${remainingMinutes !== 1 ? \"s\" : \"\"}`;\n\t\t} else {\n\t\t\treturn `in ${minutes} minute${minutes !== 1 ? \"s\" : \"\"}`;\n\t\t}\n\t}\n\n\t// ============================================================\n\t// STATE MANAGEMENT\n\t// ============================================================\n\n\tconst State = {\n\t\t_observers: [],\n\t\t_state: {\n\t\t\tscheduleModalOpen: false,\n\t\t\tselectedScheduleTime: null,\n\t\t\tpendingScheduledAt: null,\n\t\t\tscheduledCount: 0,\n\t\t\tisInitialized: false,\n\t\t\tpatchesApplied: false,\n\t\t},\n\n\t\tget(key) {\n\t\t\treturn this._state[key];\n\t\t},\n\n\t\tset(key, value) {\n\t\t\tconst oldValue = this._state[key];\n\t\t\tthis._state[key] = value;\n\t\t\tLogger.debug(`State changed: ${key}`, { old: oldValue, new: value });\n\t\t\tthis._notifyObservers(key, value, oldValue);\n\t\t},\n\n\t\tsubscribe(callback) {\n\t\t\tthis._observers.push(callback);\n\t\t\treturn () => {\n\t\t\t\tthis._observers = this._observers.filter((cb) => cb !== callback);\n\t\t\t};\n\t\t},\n\n\t\t_notifyObservers(key, newValue, oldValue) {\n\t\t\tthis._observers.forEach((callback) => {\n\t\t\t\ttry {\n\t\t\t\t\tcallback(key, newValue, oldValue);\n\t\t\t\t} catch (e) {\n\t\t\t\t\tLogger.error(\"Error in state observer:\", e);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\t// Cleanup method for memory management\n\t\treset() {\n\t\t\tthis._state = {\n\t\t\t\tscheduleModalOpen: false,\n\t\t\t\tselectedScheduleTime: null,\n\t\t\t\tpendingScheduledAt: null,\n\t\t\t\tscheduledCount: 0,\n\t\t\t\tisInitialized: false,\n\t\t\t\tpatchesApplied: false,\n\t\t\t};\n\t\t\tLogger.debug(\"State reset\");\n\t\t},\n\t};\n\n\t// ============================================================\n\t// API INTERCEPTION\n\t// ============================================================\n\n\tlet originalFetch = null;\n\tlet originalFrappeCall = null;\n\n\t/**\n\t * Patch window.fetch to intercept mail API calls\n\t */\n\tfunction patchFetch() {\n\t\tif (originalFetch) {\n\t\t\tLogger.debug(\"Fetch already patched, skipping\");\n\t\t\treturn;\n\t\t}\n\n\t\toriginalFetch = window.fetch;\n\n\t\twindow.fetch = async function (url, options = {}) {\n\t\t\tconst pendingScheduledAt = State.get(\"pendingScheduledAt\");\n\n\t\t\t// Check if this is a mail API call with pending schedule\n\t\t\tif (pendingScheduledAt && options?.body && options?.method === \"POST\") {\n\t\t\t\tconst urlStr = String(url);\n\n\t\t\t\t// Check if it's a mail creation/update call\n\t\t\t\tconst isCreateCall = urlStr.includes(`/api/method/${ENDPOINTS.ORIGINAL_CREATE}`);\n\t\t\t\tconst isUpdateCall = urlStr.includes(`/api/method/${ENDPOINTS.ORIGINAL_UPDATE}`);\n\n\t\t\t\tif (isCreateCall || isUpdateCall) {\n\t\t\t\t\tLogger.info(\"Intercepting fetch call:\", urlStr);\n\t\t\t\t\tLogger.debug(\"Pending scheduled_at:\", pendingScheduledAt);\n\n\t\t\t\t\t// Check rate limiting\n\t\t\t\t\tif (isRateLimited()) {\n\t\t\t\t\t\tLogger.warn(\"Rate limited, rejecting request\");\n\t\t\t\t\t\tthrow new Error(\"Too many requests. Please try again in a moment.\");\n\t\t\t\t\t}\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Parse and modify body\n\t\t\t\t\t\tlet body;\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tbody =\n\t\t\t\t\t\t\t\ttypeof options.body === \"string\"\n\t\t\t\t\t\t\t\t\t? JSON.parse(options.body)\n\t\t\t\t\t\t\t\t\t: options.body;\n\t\t\t\t\t\t} catch (parseError) {\n\t\t\t\t\t\t\tLogger.error(\"Failed to parse request body:\", parseError);\n\t\t\t\t\t\t\tState.set(\"pendingScheduledAt\", null);\n\t\t\t\t\t\t\treturn originalFetch.call(this, url, options);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Redirect to our API\n\t\t\t\t\t\tconst newEndpoint = isCreateCall\n\t\t\t\t\t\t\t? ENDPOINTS.CREATE_MAIL\n\t\t\t\t\t\t\t: ENDPOINTS.UPDATE_DRAFT;\n\t\t\t\t\t\tconst newUrl = urlStr.replace(\n\t\t\t\t\t\t\tisCreateCall ? ENDPOINTS.ORIGINAL_CREATE : ENDPOINTS.ORIGINAL_UPDATE,\n\t\t\t\t\t\t\tnewEndpoint\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tLogger.info(\"Redirecting to:\", newUrl);\n\n\t\t\t\t\t\t// Inject scheduled_at\n\t\t\t\t\t\tbody.scheduled_at = pendingScheduledAt;\n\n\t\t\t\t\t\t// Store for callback\n\t\t\t\t\t\tconst scheduledAt = pendingScheduledAt;\n\t\t\t\t\t\tState.set(\"pendingScheduledAt\", null);\n\n\t\t\t\t\t\tconst newOptions = {\n\t\t\t\t\t\t\t...options,\n\t\t\t\t\t\t\tbody: JSON.stringify(body),\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\t// Record request for rate limiting\n\t\t\t\t\t\trecordRequest();\n\n\t\t\t\t\t\t// Make the call with retry logic\n\t\t\t\t\t\tconst response = await retryWithBackoff(async () => {\n\t\t\t\t\t\t\tconst resp = await originalFetch.call(this, newUrl, newOptions);\n\t\t\t\t\t\t\tif (!resp.ok && resp.status >= 500) {\n\t\t\t\t\t\t\t\tthrow new Error(`Server error: ${resp.status}`);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn resp;\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Handle response\n\t\t\t\t\t\tif (response.ok) {\n\t\t\t\t\t\t\t// Show success toast after a brief delay for better UX\n\t\t\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\t\t\tshowToast(\n\t\t\t\t\t\t\t\t\t\"Email Scheduled\",\n\t\t\t\t\t\t\t\t\t`Your email will be sent on ${formatScheduledDate(scheduledAt)}`,\n\t\t\t\t\t\t\t\t\t\"success\"\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t// Refresh scheduled count\n\t\t\t\t\t\t\t\tloadScheduledCount();\n\t\t\t\t\t\t\t}, 100);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Try to get error message from response\n\t\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\t\tconst errorData = await response.clone().json();\n\t\t\t\t\t\t\t\tconst errorMsg =\n\t\t\t\t\t\t\t\t\terrorData?.exception ||\n\t\t\t\t\t\t\t\t\terrorData?.message ||\n\t\t\t\t\t\t\t\t\t\"Failed to schedule email\";\n\t\t\t\t\t\t\t\tLogger.error(\"API error:\", errorMsg);\n\t\t\t\t\t\t\t\tshowToast(\"Scheduling Failed\", sanitizeHTML(errorMsg), \"error\");\n\t\t\t\t\t\t\t} catch {\n\t\t\t\t\t\t\t\tshowToast(\"Scheduling Failed\", \"An unexpected error occurred\", \"error\");\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn response;\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tLogger.error(\"Error intercepting fetch:\", e);\n\t\t\t\t\t\tState.set(\"pendingScheduledAt\", null);\n\t\t\t\t\t\tshowToast(\"Scheduling Failed\", sanitizeHTML(e.message), \"error\");\n\t\t\t\t\t\tthrow e;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Pass through for non-intercepted calls\n\t\t\treturn originalFetch.call(this, url, options);\n\t\t};\n\n\t\tLogger.info(\"Patched window.fetch for API interception\");\n\t}\n\n\t/**\n\t * Patch frappe.call for legacy API calls\n\t */\n\tfunction patchFrappeCall() {\n\t\tif (typeof frappe === \"undefined\" || !frappe.call) {\n\t\t\tLogger.debug(\"frappe.call not available, skipping patch\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (originalFrappeCall) {\n\t\t\tLogger.debug(\"frappe.call already patched, skipping\");\n\t\t\treturn;\n\t\t}\n\n\t\toriginalFrappeCall = frappe.call;\n\n\t\tfrappe.call = function (opts) {\n\t\t\tconst pendingScheduledAt = State.get(\"pendingScheduledAt\");\n\n\t\t\tif (pendingScheduledAt) {\n\t\t\t\tconst method = opts.method || (opts.args && opts.args.method);\n\n\t\t\t\t// Check if this is a mail create/update call\n\t\t\t\tif (\n\t\t\t\t\tmethod === ENDPOINTS.ORIGINAL_CREATE ||\n\t\t\t\t\tmethod === ENDPOINTS.ORIGINAL_UPDATE\n\t\t\t\t) {\n\t\t\t\t\tLogger.info(\"Intercepting frappe.call:\", method);\n\n\t\t\t\t\t// Check rate limiting\n\t\t\t\t\tif (isRateLimited()) {\n\t\t\t\t\t\tLogger.warn(\"Rate limited, rejecting request\");\n\t\t\t\t\t\tif (opts.error) {\n\t\t\t\t\t\t\topts.error({ message: \"Too many requests\" });\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn Promise.reject(new Error(\"Too many requests\"));\n\t\t\t\t\t}\n\n\t\t\t\t\tconst newOpts = { ...opts };\n\n\t\t\t\t\t// Redirect to our API\n\t\t\t\t\tnewOpts.method =\n\t\t\t\t\t\tmethod === ENDPOINTS.ORIGINAL_CREATE\n\t\t\t\t\t\t\t? ENDPOINTS.CREATE_MAIL\n\t\t\t\t\t\t\t: ENDPOINTS.UPDATE_DRAFT;\n\n\t\t\t\t\tnewOpts.args = { ...opts.args, scheduled_at: pendingScheduledAt };\n\n\t\t\t\t\tconst scheduledAt = pendingScheduledAt;\n\t\t\t\t\tState.set(\"pendingScheduledAt\", null);\n\n\t\t\t\t\t// Wrap success callback\n\t\t\t\t\tconst originalCallback = newOpts.callback || newOpts.success;\n\t\t\t\t\tnewOpts.callback = function (response) {\n\t\t\t\t\t\tshowToast(\n\t\t\t\t\t\t\t\"Email Scheduled\",\n\t\t\t\t\t\t\t`Your email will be sent on ${formatScheduledDate(scheduledAt)}`,\n\t\t\t\t\t\t\t\"success\"\n\t\t\t\t\t\t);\n\t\t\t\t\t\tloadScheduledCount();\n\t\t\t\t\t\tif (originalCallback) {\n\t\t\t\t\t\t\toriginalCallback.call(this, response);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\t// Wrap error callback\n\t\t\t\t\tconst originalError = newOpts.error;\n\t\t\t\t\tnewOpts.error = function (response) {\n\t\t\t\t\t\tconst msg = response?.message || \"Failed to schedule email\";\n\t\t\t\t\t\tshowToast(\"Scheduling Failed\", sanitizeHTML(msg), \"error\");\n\t\t\t\t\t\tif (originalError) {\n\t\t\t\t\t\t\toriginalError.call(this, response);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\n\t\t\t\t\trecordRequest();\n\t\t\t\t\treturn originalFrappeCall.call(this, newOpts);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn originalFrappeCall.call(this, opts);\n\t\t};\n\n\t\tLogger.info(\"Patched frappe.call for API interception\");\n\t}\n\n\t/**\n\t * Apply all patches\n\t */\n\tfunction applyPatches() {\n\t\tif (State.get(\"patchesApplied\")) {\n\t\t\tLogger.debug(\"Patches already applied, skipping\");\n\t\t\treturn;\n\t\t}\n\n\t\tpatchFetch();\n\t\tpatchFrappeCall();\n\t\tState.set(\"patchesApplied\", true);\n\t\tLogger.info(\"All API patches applied\");\n\t}\n\n\t/**\n\t * Remove patches (for cleanup)\n\t */\n\tfunction removePatches() {\n\t\tif (originalFetch) {\n\t\t\twindow.fetch = originalFetch;\n\t\t\toriginalFetch = null;\n\t\t}\n\t\tif (originalFrappeCall && typeof frappe !== \"undefined\") {\n\t\t\tfrappe.call = originalFrappeCall;\n\t\t\toriginalFrappeCall = null;\n\t\t}\n\t\tState.set(\"patchesApplied\", false);\n\t\tLogger.info(\"Patches removed\");\n\t}\n\n\t// ============================================================\n\t// UI COMPONENTS\n\t// ============================================================\n\n\t/**\n\t * Show toast notification\n\t * @param {string} title - Toast title\n\t * @param {string} message - Toast message\n\t * @param {string} type - Toast type (success, error, warning, info)\n\t */\n\tfunction showToast(title, message, type = \"success\") {\n\t\tconst indicatorMap = {\n\t\t\tsuccess: \"green\",\n\t\t\terror: \"red\",\n\t\t\twarning: \"orange\",\n\t\t\tinfo: \"blue\",\n\t\t};\n\n\t\tif (typeof frappe !== \"undefined\" && frappe.toast) {\n\t\t\tfrappe.toast({\n\t\t\t\ttitle: sanitizeHTML(title),\n\t\t\t\tmessage: sanitizeHTML(message),\n\t\t\t\tindicator: indicatorMap[type] || \"blue\",\n\t\t\t});\n\t\t} else {\n\t\t\t// Fallback toast using native DOM\n\t\t\tconst toast = document.createElement(\"div\");\n\t\t\ttoast.className = `mail-scheduler-toast mail-scheduler-toast-${type}`;\n\t\t\ttoast.innerHTML = `\n\t\t\t\t<strong>${sanitizeHTML(title)}</strong>\n\t\t\t\t<span>${sanitizeHTML(message)}</span>\n\t\t\t`;\n\t\t\tdocument.body.appendChild(toast);\n\n\t\t\tsetTimeout(() => {\n\t\t\t\ttoast.classList.add(\"show\");\n\t\t\t}, 10);\n\n\t\t\tsetTimeout(() => {\n\t\t\t\ttoast.classList.remove(\"show\");\n\t\t\t\tsetTimeout(() => toast.remove(), 300);\n\t\t\t}, config.toast_duration_ms);\n\t\t}\n\t}\n\n\t/**\n\t * Get quick option date\n\t * @param {string} action - Quick option action\n\t * @returns {Date} Calculated date\n\t */\n\tfunction getQuickOptionDate(action) {\n\t\tconst now = new Date();\n\t\tconst tomorrow = new Date(now);\n\t\ttomorrow.setDate(tomorrow.getDate() + 1);\n\n\t\tswitch (action) {\n\t\t\tcase \"tomorrow-am\":\n\t\t\t\ttomorrow.setHours(8, 0, 0, 0);\n\t\t\t\treturn tomorrow;\n\t\t\tcase \"tomorrow-pm\":\n\t\t\t\ttomorrow.setHours(13, 0, 0, 0);\n\t\t\t\treturn tomorrow;\n\t\t\tcase \"monday-am\": {\n\t\t\t\tconst monday = new Date(now);\n\t\t\t\tconst daysUntilMonday = (8 - now.getDay()) % 7 || 7;\n\t\t\t\tmonday.setDate(monday.getDate() + daysUntilMonday);\n\t\t\t\tmonday.setHours(8, 0, 0, 0);\n\t\t\t\treturn monday;\n\t\t\t}\n\t\t\tdefault:\n\t\t\t\ttomorrow.setHours(9, 0, 0, 0);\n\t\t\t\treturn tomorrow;\n\t\t}\n\t}\n\n\t/**\n\t * Get quick option label\n\t * @param {string} action - Quick option action\n\t * @returns {string} Formatted label\n\t */\n\tfunction getQuickOptionLabel(action) {\n\t\treturn formatScheduledDate(getQuickOptionDate(action));\n\t}\n\n\t/**\n\t * Create schedule dropdown HTML\n\t * @returns {string} HTML string\n\t */\n\tfunction createDropdownHTML() {\n\t\treturn `\n\t\t\t<button class=\"mail-scheduler-btn\" type=\"button\" aria-haspopup=\"true\" aria-expanded=\"false\">\n\t\t\t\t${icons.clock}\n\t\t\t\t<span>Schedule</span>\n\t\t\t\t${icons.chevronUp}\n\t\t\t</button>\n\t\t\t<div class=\"mail-scheduler-menu\" role=\"menu\">\n\t\t\t\t<div class=\"mail-scheduler-menu-item\" data-action=\"tomorrow-am\" role=\"menuitem\" tabindex=\"-1\">\n\t\t\t\t\t${icons.sunrise}\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div class=\"label\">Tomorrow morning</div>\n\t\t\t\t\t\t<div class=\"sublabel\">${sanitizeHTML(getQuickOptionLabel(\"tomorrow-am\"))}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"mail-scheduler-menu-item\" data-action=\"tomorrow-pm\" role=\"menuitem\" tabindex=\"-1\">\n\t\t\t\t\t${icons.sun}\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div class=\"label\">Tomorrow afternoon</div>\n\t\t\t\t\t\t<div class=\"sublabel\">${sanitizeHTML(getQuickOptionLabel(\"tomorrow-pm\"))}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"mail-scheduler-menu-item\" data-action=\"monday-am\" role=\"menuitem\" tabindex=\"-1\">\n\t\t\t\t\t${icons.calendar}\n\t\t\t\t\t<div>\n\t\t\t\t\t\t<div class=\"label\">Monday morning</div>\n\t\t\t\t\t\t<div class=\"sublabel\">${sanitizeHTML(getQuickOptionLabel(\"monday-am\"))}</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"mail-scheduler-divider\" role=\"separator\"></div>\n\t\t\t\t<div class=\"mail-scheduler-menu-item\" data-action=\"custom\" role=\"menuitem\" tabindex=\"-1\">\n\t\t\t\t\t${icons.clock}\n\t\t\t\t\t<div class=\"label\">Pick date & time...</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Inject schedule button into toolbar\n\t * @param {Element} container - Toolbar container\n\t * @param {Element} sendButton - Send button element\n\t */\n\tfunction injectScheduleButton(container, sendButton) {\n\t\t// Prevent double injection\n\t\tif (container.querySelector(\".mail-scheduler-dropdown\")) {\n\t\t\tLogger.debug(\"Schedule button already exists, skipping injection\");\n\t\t\treturn;\n\t\t}\n\n\t\tconst dropdown = document.createElement(\"div\");\n\t\tdropdown.className = \"mail-scheduler-dropdown\";\n\t\tdropdown.innerHTML = createDropdownHTML();\n\n\t\t// Insert before Send button\n\t\tsendButton.parentNode.insertBefore(dropdown, sendButton);\n\n\t\tconst btn = dropdown.querySelector(\".mail-scheduler-btn\");\n\t\tconst menu = dropdown.querySelector(\".mail-scheduler-menu\");\n\n\t\t// Toggle menu with proper ARIA\n\t\tbtn.addEventListener(\"click\", (e) => {\n\t\t\te.stopPropagation();\n\t\t\tconst isOpen = dropdown.classList.toggle(\"open\");\n\t\t\tbtn.setAttribute(\"aria-expanded\", isOpen);\n\n\t\t\tif (isOpen) {\n\t\t\t\t// Focus first menu item for keyboard navigation\n\t\t\t\tconst firstItem = menu.querySelector(\".mail-scheduler-menu-item\");\n\t\t\t\tif (firstItem) firstItem.focus();\n\t\t\t}\n\t\t});\n\n\t\t// Keyboard navigation\n\t\tdropdown.addEventListener(\"keydown\", (e) => {\n\t\t\tif (!dropdown.classList.contains(\"open\")) return;\n\n\t\t\tconst items = [...menu.querySelectorAll(\".mail-scheduler-menu-item\")];\n\t\t\tconst currentIndex = items.indexOf(document.activeElement);\n\n\t\t\tswitch (e.key) {\n\t\t\t\tcase \"ArrowDown\":\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\titems[(currentIndex + 1) % items.length]?.focus();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"ArrowUp\":\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\titems[(currentIndex - 1 + items.length) % items.length]?.focus();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"Escape\":\n\t\t\t\t\tdropdown.classList.remove(\"open\");\n\t\t\t\t\tbtn.setAttribute(\"aria-expanded\", \"false\");\n\t\t\t\t\tbtn.focus();\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"Enter\":\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tdocument.activeElement?.click();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\n\t\t// Close on outside click\n\t\tconst closeHandler = (e) => {\n\t\t\tif (!dropdown.contains(e.target)) {\n\t\t\t\tdropdown.classList.remove(\"open\");\n\t\t\t\tbtn.setAttribute(\"aria-expanded\", \"false\");\n\t\t\t}\n\t\t};\n\t\tdocument.addEventListener(\"click\", closeHandler);\n\n\t\t// Store cleanup function\n\t\tdropdown._cleanup = () => {\n\t\t\tdocument.removeEventListener(\"click\", closeHandler);\n\t\t};\n\n\t\t// Handle menu items\n\t\tmenu.querySelectorAll(\".mail-scheduler-menu-item\").forEach((item) => {\n\t\t\titem.addEventListener(\"click\", (e) => {\n\t\t\t\te.stopPropagation();\n\t\t\t\tconst action = item.dataset.action;\n\t\t\t\tdropdown.classList.remove(\"open\");\n\t\t\t\tbtn.setAttribute(\"aria-expanded\", \"false\");\n\n\t\t\t\tif (action === \"custom\") {\n\t\t\t\t\topenScheduleModal(sendButton);\n\t\t\t\t} else {\n\t\t\t\t\tconst scheduledAt = getQuickOptionDate(action);\n\t\t\t\t\tconst validation = validateScheduleDate(scheduledAt);\n\n\t\t\t\t\tif (!validation.isValid) {\n\t\t\t\t\t\tshowToast(\"Invalid Schedule Time\", validation.error, \"error\");\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\ttriggerScheduledSend(sendButton, scheduledAt);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\tLogger.info(\"Schedule button injected successfully\");\n\t}\n\n\t/**\n\t * Open schedule modal\n\t * @param {Element} sendButton - Send button element\n\t */\n\tfunction openScheduleModal(sendButton) {\n\t\t// Remove any existing modal\n\t\tconst existing = document.querySelector(\".mail-scheduler-modal-overlay\");\n\t\tif (existing) {\n\t\t\texisting.remove();\n\t\t}\n\n\t\tState.set(\"scheduleModalOpen\", true);\n\n\t\t// Create modal\n\t\tconst overlay = document.createElement(\"div\");\n\t\toverlay.className = \"mail-scheduler-modal-overlay\";\n\t\toverlay.setAttribute(\"role\", \"dialog\");\n\t\toverlay.setAttribute(\"aria-modal\", \"true\");\n\t\toverlay.setAttribute(\"aria-labelledby\", \"mail-scheduler-modal-title\");\n\t\toverlay.innerHTML = createModalHTML();\n\t\tdocument.body.appendChild(overlay);\n\n\t\t// Trap focus within modal\n\t\tconst focusableElements = overlay.querySelectorAll(\n\t\t\t'button, [href], input, select, textarea, [tabindex]:not([tabindex=\"-1\"])'\n\t\t);\n\t\tconst firstFocusable = focusableElements[0];\n\t\tconst lastFocusable = focusableElements[focusableElements.length - 1];\n\n\t\toverlay.addEventListener(\"keydown\", (e) => {\n\t\t\tif (e.key === \"Tab\") {\n\t\t\t\tif (e.shiftKey && document.activeElement === firstFocusable) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tlastFocusable.focus();\n\t\t\t\t} else if (!e.shiftKey && document.activeElement === lastFocusable) {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tfirstFocusable.focus();\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (e.key === \"Escape\") {\n\t\t\t\tcloseModal();\n\t\t\t}\n\t\t});\n\n\t\t// Initialize modal with animation\n\t\trequestAnimationFrame(() => {\n\t\t\toverlay.classList.add(\"open\");\n\t\t\tinitializeModal(overlay, sendButton);\n\t\t\tfirstFocusable?.focus();\n\t\t});\n\n\t\tfunction closeModal() {\n\t\t\tState.set(\"scheduleModalOpen\", false);\n\t\t\toverlay.classList.remove(\"open\");\n\t\t\tsetTimeout(() => {\n\t\t\t\toverlay.remove();\n\t\t\t}, 200);\n\t\t}\n\n\t\t// Store close function for access within initializeModal\n\t\toverlay._close = closeModal;\n\t}\n\n\t/**\n\t * Create modal HTML\n\t * @returns {string} HTML string\n\t */\n\tfunction createModalHTML() {\n\t\tconst timeFormat = localStorage.getItem(\"mailSchedulerTimeFormat\") || \"12h\";\n\n\t\treturn `\n\t\t\t<div class=\"mail-scheduler-modal\">\n\t\t\t\t<div class=\"mail-scheduler-modal-header\">\n\t\t\t\t\t<div class=\"mail-scheduler-modal-title\" id=\"mail-scheduler-modal-title\">Schedule Send</div>\n\t\t\t\t\t<button class=\"mail-scheduler-modal-close\" type=\"button\" aria-label=\"Close dialog\">\n\t\t\t\t\t\t${icons.x}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"mail-scheduler-modal-body\">\n\t\t\t\t\t<!-- Quick Options -->\n\t\t\t\t\t<div class=\"mail-scheduler-quick-options\" role=\"group\" aria-label=\"Quick schedule options\">\n\t\t\t\t\t\t<div class=\"mail-scheduler-quick-option\" data-action=\"tomorrow-am\" role=\"button\" tabindex=\"0\">\n\t\t\t\t\t\t\t${icons.sunrise}\n\t\t\t\t\t\t\t<div class=\"label\">Tomorrow</div>\n\t\t\t\t\t\t\t<div class=\"time\">8:00 AM</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"mail-scheduler-quick-option\" data-action=\"tomorrow-pm\" role=\"button\" tabindex=\"0\">\n\t\t\t\t\t\t\t${icons.sun}\n\t\t\t\t\t\t\t<div class=\"label\">Tomorrow</div>\n\t\t\t\t\t\t\t<div class=\"time\">1:00 PM</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"mail-scheduler-quick-option\" data-action=\"monday-am\" role=\"button\" tabindex=\"0\">\n\t\t\t\t\t\t\t${icons.calendar}\n\t\t\t\t\t\t\t<div class=\"label\">Monday</div>\n\t\t\t\t\t\t\t<div class=\"time\">8:00 AM</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<!-- Calendar -->\n\t\t\t\t\t<div class=\"mail-scheduler-calendar\" role=\"application\" aria-label=\"Calendar\">\n\t\t\t\t\t\t<div class=\"mail-scheduler-calendar-header\">\n\t\t\t\t\t\t\t<button class=\"mail-scheduler-calendar-nav\" data-action=\"prev\" type=\"button\" aria-label=\"Previous month\">\n\t\t\t\t\t\t\t\t${icons.chevronLeft}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t<div class=\"mail-scheduler-calendar-month\" aria-live=\"polite\"></div>\n\t\t\t\t\t\t\t<button class=\"mail-scheduler-calendar-nav\" data-action=\"next\" type=\"button\" aria-label=\"Next month\">\n\t\t\t\t\t\t\t\t${icons.chevronRight}\n\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"mail-scheduler-calendar-weekdays\" role=\"row\">\n\t\t\t\t\t\t\t<div class=\"mail-scheduler-calendar-weekday\" role=\"columnheader\">S</div>\n\t\t\t\t\t\t\t<div class=\"mail-scheduler-calendar-weekday\" role=\"columnheader\">M</div>\n\t\t\t\t\t\t\t<div class=\"mail-scheduler-calendar-weekday\" role=\"columnheader\">T</div>\n\t\t\t\t\t\t\t<div class=\"mail-scheduler-calendar-weekday\" role=\"columnheader\">W</div>\n\t\t\t\t\t\t\t<div class=\"mail-scheduler-calendar-weekday\" role=\"columnheader\">T</div>\n\t\t\t\t\t\t\t<div class=\"mail-scheduler-calendar-weekday\" role=\"columnheader\">F</div>\n\t\t\t\t\t\t\t<div class=\"mail-scheduler-calendar-weekday\" role=\"columnheader\">S</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"mail-scheduler-calendar-days\" role=\"grid\"></div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<!-- Time -->\n\t\t\t\t\t<div class=\"mail-scheduler-time\">\n\t\t\t\t\t\t<div class=\"mail-scheduler-time-header\">\n\t\t\t\t\t\t\t<label class=\"mail-scheduler-time-label\" for=\"mail-scheduler-hour\">Time</label>\n\t\t\t\t\t\t\t<div class=\"mail-scheduler-time-format\" role=\"group\" aria-label=\"Time format\">\n\t\t\t\t\t\t\t\t<button data-format=\"12h\" type=\"button\" class=\"${timeFormat === \"12h\" ? \"active\" : \"\"}\" aria-pressed=\"${timeFormat === \"12h\"}\">12h</button>\n\t\t\t\t\t\t\t\t<button data-format=\"24h\" type=\"button\" class=\"${timeFormat === \"24h\" ? \"active\" : \"\"}\" aria-pressed=\"${timeFormat === \"24h\"}\">24h</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class=\"mail-scheduler-time-inputs\">\n\t\t\t\t\t\t\t<select class=\"mail-scheduler-hour\" id=\"mail-scheduler-hour\" aria-label=\"Hour\"></select>\n\t\t\t\t\t\t\t<span class=\"mail-scheduler-time-separator\" aria-hidden=\"true\">:</span>\n\t\t\t\t\t\t\t<select class=\"mail-scheduler-minute\" aria-label=\"Minute\">\n\t\t\t\t\t\t\t\t<option value=\"0\">00</option>\n\t\t\t\t\t\t\t\t<option value=\"15\">15</option>\n\t\t\t\t\t\t\t\t<option value=\"30\">30</option>\n\t\t\t\t\t\t\t\t<option value=\"45\">45</option>\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t\t<select class=\"mail-scheduler-period ${timeFormat === \"24h\" ? \"hidden\" : \"\"}\" aria-label=\"AM/PM\">\n\t\t\t\t\t\t\t\t<option value=\"AM\">AM</option>\n\t\t\t\t\t\t\t\t<option value=\"PM\">PM</option>\n\t\t\t\t\t\t\t</select>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\n\t\t\t\t\t<!-- Summary -->\n\t\t\t\t\t<div class=\"mail-scheduler-summary\" role=\"status\" aria-live=\"polite\">\n\t\t\t\t\t\t${icons.clock}\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div class=\"mail-scheduler-summary-text\">Your email will be sent on:</div>\n\t\t\t\t\t\t\t<div class=\"mail-scheduler-summary-date\"></div>\n\t\t\t\t\t\t\t<div class=\"mail-scheduler-summary-relative\"></div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class=\"mail-scheduler-modal-footer\">\n\t\t\t\t\t<button class=\"mail-scheduler-btn-secondary\" data-action=\"cancel\" type=\"button\">Cancel</button>\n\t\t\t\t\t<button class=\"mail-scheduler-btn-primary\" data-action=\"confirm\" type=\"button\">\n\t\t\t\t\t\t${icons.send}\n\t\t\t\t\t\tSchedule Send\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`;\n\t}\n\n\t/**\n\t * Initialize modal functionality\n\t * @param {Element} overlay - Modal overlay element\n\t * @param {Element} sendButton - Send button element\n\t */\n\tfunction initializeModal(overlay, sendButton) {\n\t\tconst modal = overlay.querySelector(\".mail-scheduler-modal\");\n\t\tconst monthLabel = modal.querySelector(\".mail-scheduler-calendar-month\");\n\t\tconst daysContainer = modal.querySelector(\".mail-scheduler-calendar-days\");\n\t\tconst hourSelect = modal.querySelector(\".mail-scheduler-hour\");\n\t\tconst minuteSelect = modal.querySelector(\".mail-scheduler-minute\");\n\t\tconst periodSelect = modal.querySelector(\".mail-scheduler-period\");\n\t\tconst summaryDate = modal.querySelector(\".mail-scheduler-summary-date\");\n\t\tconst summaryRelative = modal.querySelector(\".mail-scheduler-summary-relative\");\n\n\t\tlet currentMonth = new Date().getMonth();\n\t\tlet currentYear = new Date().getFullYear();\n\t\tlet selectedDate = new Date();\n\t\tselectedDate.setDate(selectedDate.getDate() + 1);\n\t\tlet timeFormat = localStorage.getItem(\"mailSchedulerTimeFormat\") || \"12h\";\n\n\t\t// Helper functions\n\t\tfunction populateHours() {\n\t\t\thourSelect.innerHTML = \"\";\n\t\t\tif (timeFormat === \"12h\") {\n\t\t\t\tfor (let i = 1; i <= 12; i++) {\n\t\t\t\t\tconst option = document.createElement(\"option\");\n\t\t\t\t\toption.value = i;\n\t\t\t\t\toption.textContent = i;\n\t\t\t\t\thourSelect.appendChild(option);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tfor (let i = 0; i < 24; i++) {\n\t\t\t\t\tconst option = document.createElement(\"option\");\n\t\t\t\t\toption.value = i;\n\t\t\t\t\toption.textContent = i.toString().padStart(2, \"0\");\n\t\t\t\t\thourSelect.appendChild(option);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction renderCalendar() {\n\t\t\tconst months = [\n\t\t\t\t\"January\", \"February\", \"March\", \"April\", \"May\", \"June\",\n\t\t\t\t\"July\", \"August\", \"September\", \"October\", \"November\", \"December\",\n\t\t\t];\n\t\t\tmonthLabel.textContent = `${months[currentMonth]} ${currentYear}`;\n\n\t\t\tconst firstDay = new Date(currentYear, currentMonth, 1);\n\t\t\tconst lastDay = new Date(currentYear, currentMonth + 1, 0);\n\t\t\tconst startPadding = firstDay.getDay();\n\t\t\tconst today = new Date();\n\t\t\ttoday.setHours(0, 0, 0, 0);\n\t\t\tconst maxDate = new Date();\n\t\t\tmaxDate.setDate(maxDate.getDate() + config.max_schedule_days);\n\n\t\t\tlet html = \"\";\n\n\t\t\t// Previous month padding\n\t\t\tconst prevMonthLast = new Date(currentYear, currentMonth, 0);\n\t\t\tfor (let i = startPadding - 1; i >= 0; i--) {\n\t\t\t\tconst d = prevMonthLast.getDate() - i;\n\t\t\t\thtml += `<div class=\"mail-scheduler-calendar-day other-month disabled\" aria-hidden=\"true\">${d}</div>`;\n\t\t\t}\n\n\t\t\t// Current month\n\t\t\tfor (let i = 1; i <= lastDay.getDate(); i++) {\n\t\t\t\tconst date = new Date(currentYear, currentMonth, i);\n\t\t\t\tdate.setHours(0, 0, 0, 0);\n\t\t\t\tconst isPast = date < today;\n\t\t\t\tconst isTooFar = date > maxDate;\n\t\t\t\tconst isToday = date.getTime() === today.getTime();\n\t\t\t\tconst isSelected =\n\t\t\t\t\tselectedDate && date.toDateString() === selectedDate.toDateString();\n\n\t\t\t\tconst classes = [\"mail-scheduler-calendar-day\"];\n\t\t\t\tconst disabled = isPast || isTooFar;\n\n\t\t\t\tif (disabled) classes.push(\"disabled\");\n\t\t\t\tif (isToday) classes.push(\"today\");\n\t\t\t\tif (isSelected) classes.push(\"selected\");\n\n\t\t\t\tconst ariaLabel = date.toLocaleDateString(\"en-US\", {\n\t\t\t\t\tweekday: \"long\",\n\t\t\t\t\tmonth: \"long\",\n\t\t\t\t\tday: \"numeric\",\n\t\t\t\t});\n\n\t\t\t\thtml += `<div class=\"${classes.join(\" \")}\" \n\t\t\t\t\tdata-date=\"${date.toISOString()}\" \n\t\t\t\t\trole=\"gridcell\" \n\t\t\t\t\ttabindex=\"${isSelected ? \"0\" : \"-1\"}\"\n\t\t\t\t\taria-label=\"${ariaLabel}\"\n\t\t\t\t\taria-selected=\"${isSelected}\"\n\t\t\t\t\taria-disabled=\"${disabled}\"\n\t\t\t\t\t${disabled ? \"\" : 'style=\"cursor: pointer\"'}>${i}</div>`;\n\t\t\t}\n\n\t\t\t// Next month padding\n\t\t\tconst remaining = 42 - (startPadding + lastDay.getDate());\n\t\t\tfor (let i = 1; i <= remaining; i++) {\n\t\t\t\thtml += `<div class=\"mail-scheduler-calendar-day other-month disabled\" aria-hidden=\"true\">${i}</div>`;\n\t\t\t}\n\n\t\t\tdaysContainer.innerHTML = html;\n\n\t\t\t// Add click handlers to valid days\n\t\t\tdaysContainer\n\t\t\t\t.querySelectorAll(\".mail-scheduler-calendar-day:not(.disabled):not(.other-month)\")\n\t\t\t\t.forEach((day) => {\n\t\t\t\t\tday.addEventListener(\"click\", () => {\n\t\t\t\t\t\tselectedDate = new Date(day.dataset.date);\n\t\t\t\t\t\trenderCalendar();\n\t\t\t\t\t\tupdateSummary();\n\t\t\t\t\t\thighlightQuickOption();\n\t\t\t\t\t});\n\n\t\t\t\t\t// Keyboard support for calendar\n\t\t\t\t\tday.addEventListener(\"keydown\", (e) => {\n\t\t\t\t\t\tif (e.key === \"Enter\" || e.key === \" \") {\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\tday.click();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t}\n\n\t\tfunction getSelectedDateTime() {\n\t\t\tconst date = new Date(selectedDate);\n\t\t\tlet hour = parseInt(hourSelect.value, 10);\n\t\t\tconst minute = parseInt(minuteSelect.value, 10);\n\n\t\t\tif (timeFormat === \"12h\") {\n\t\t\t\tif (periodSelect.value === \"PM\" && hour !== 12) hour += 12;\n\t\t\t\tif (periodSelect.value === \"AM\" && hour === 12) hour = 0;\n\t\t\t}\n\n\t\t\tdate.setHours(hour, minute, 0, 0);\n\t\t\treturn date;\n\t\t}\n\n\t\tfunction updateSummary() {\n\t\t\tconst date = getSelectedDateTime();\n\t\t\tsummaryDate.textContent = date.toLocaleString(\"en-US\", {\n\t\t\t\tweekday: \"long\",\n\t\t\t\tyear: \"numeric\",\n\t\t\t\tmonth: \"long\",\n\t\t\t\tday: \"numeric\",\n\t\t\t\thour: \"numeric\",\n\t\t\t\tminute: \"2-digit\",\n\t\t\t\thour12: timeFormat === \"12h\",\n\t\t\t});\n\t\t\tsummaryRelative.textContent = getRelativeTime(date);\n\n\t\t\t// Validate and show warning if needed\n\t\t\tconst validation = validateScheduleDate(date);\n\t\t\tif (!validation.isValid) {\n\t\t\t\tsummaryRelative.textContent = validation.error;\n\t\t\t\tsummaryRelative.classList.add(\"error\");\n\t\t\t} else {\n\t\t\t\tsummaryRelative.classList.remove(\"error\");\n\t\t\t}\n\t\t}\n\n\t\tfunction highlightQuickOption() {\n\t\t\tmodal.querySelectorAll(\".mail-scheduler-quick-option\").forEach((opt) => {\n\t\t\t\tconst action = opt.dataset.action;\n\t\t\t\tconst optDate = getQuickOptionDate(action);\n\t\t\t\tconst selected = getSelectedDateTime();\n\t\t\t\tconst matches =\n\t\t\t\t\toptDate.toDateString() === selected.toDateString() &&\n\t\t\t\t\toptDate.getHours() === selected.getHours() &&\n\t\t\t\t\toptDate.getMinutes() === selected.getMinutes();\n\n\t\t\t\topt.classList.toggle(\"selected\", matches);\n\t\t\t\topt.setAttribute(\"aria-pressed\", matches);\n\t\t\t});\n\t\t}\n\n\t\tfunction closeModal() {\n\t\t\tif (overlay._close) overlay._close();\n\t\t}\n\n\t\t// Initialize\n\t\tpopulateHours();\n\t\trenderCalendar();\n\t\tupdateSummary();\n\n\t\t// Set sensible defaults\n\t\thourSelect.value = timeFormat === \"12h\" ? \"9\" : \"9\";\n\t\tperiodSelect.value = \"AM\";\n\n\t\t// Event listeners\n\t\toverlay.addEventListener(\"click\", (e) => {\n\t\t\tif (e.target === overlay) closeModal();\n\t\t});\n\n\t\tmodal.querySelector(\".mail-scheduler-modal-close\").addEventListener(\"click\", closeModal);\n\t\tmodal.querySelector('[data-action=\"cancel\"]').addEventListener(\"click\", closeModal);\n\n\t\t// Confirm button\n\t\tmodal.querySelector('[data-action=\"confirm\"]').addEventListener(\"click\", () => {\n\t\t\tconst scheduledAt = getSelectedDateTime();\n\t\t\tconst validation = validateScheduleDate(scheduledAt);\n\n\t\t\tif (!validation.isValid) {\n\t\t\t\tshowToast(\"Invalid Schedule Time\", validation.error, \"error\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tcloseModal();\n\t\t\ttriggerScheduledSend(sendButton, scheduledAt);\n\t\t});\n\n\t\t// Calendar navigation\n\t\tmodal.querySelector('[data-action=\"prev\"]').addEventListener(\"click\", () => {\n\t\t\tcurrentMonth--;\n\t\t\tif (currentMonth < 0) {\n\t\t\t\tcurrentMonth = 11;\n\t\t\t\tcurrentYear--;\n\t\t\t}\n\t\t\trenderCalendar();\n\t\t});\n\n\t\tmodal.querySelector('[data-action=\"next\"]').addEventListener(\"click\", () => {\n\t\t\tcurrentMonth++;\n\t\t\tif (currentMonth > 11) {\n\t\t\t\tcurrentMonth = 0;\n\t\t\t\tcurrentYear++;\n\t\t\t}\n\t\t\trenderCalendar();\n\t\t});\n\n\t\t// Quick options\n\t\tmodal.querySelectorAll(\".mail-scheduler-quick-option\").forEach((opt) => {\n\t\t\tconst handler = () => {\n\t\t\t\tconst action = opt.dataset.action;\n\t\t\t\tconst date = getQuickOptionDate(action);\n\t\t\t\tselectedDate = date;\n\t\t\t\tcurrentMonth = date.getMonth();\n\t\t\t\tcurrentYear = date.getFullYear();\n\n\t\t\t\t// Update time inputs\n\t\t\t\tconst hours = date.getHours();\n\t\t\t\tif (timeFormat === \"12h\") {\n\t\t\t\t\thourSelect.value = hours > 12 ? hours - 12 : hours === 0 ? 12 : hours;\n\t\t\t\t\tperiodSelect.value = hours >= 12 ? \"PM\" : \"AM\";\n\t\t\t\t} else {\n\t\t\t\t\thourSelect.value = hours;\n\t\t\t\t}\n\t\t\t\tminuteSelect.value = date.getMinutes();\n\n\t\t\t\trenderCalendar();\n\t\t\t\tupdateSummary();\n\t\t\t\thighlightQuickOption();\n\t\t\t};\n\n\t\t\topt.addEventListener(\"click\", handler);\n\t\t\topt.addEventListener(\"keydown\", (e) => {\n\t\t\t\tif (e.key === \"Enter\" || e.key === \" \") {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\thandler();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\n\t\t// Time format toggle\n\t\tmodal.querySelectorAll(\".mail-scheduler-time-format button\").forEach((btn) => {\n\t\t\tbtn.addEventListener(\"click\", () => {\n\t\t\t\tconst newFormat = btn.dataset.format;\n\t\t\t\tif (newFormat === timeFormat) return;\n\n\t\t\t\tconst currentHour = parseInt(hourSelect.value, 10);\n\t\t\t\tconst currentPeriod = periodSelect.value;\n\n\t\t\t\ttimeFormat = newFormat;\n\t\t\t\tlocalStorage.setItem(\"mailSchedulerTimeFormat\", newFormat);\n\n\t\t\t\t// Update UI\n\t\t\t\tmodal.querySelectorAll(\".mail-scheduler-time-format button\").forEach((b) => {\n\t\t\t\t\tconst isActive = b.dataset.format === newFormat;\n\t\t\t\t\tb.classList.toggle(\"active\", isActive);\n\t\t\t\t\tb.setAttribute(\"aria-pressed\", isActive);\n\t\t\t\t});\n\n\t\t\t\tperiodSelect.classList.toggle(\"hidden\", newFormat === \"24h\");\n\t\t\t\tpopulateHours();\n\n\t\t\t\t// Convert hour value\n\t\t\t\tif (newFormat === \"24h\") {\n\t\t\t\t\tlet hour24 = currentHour;\n\t\t\t\t\tif (currentPeriod === \"PM\" && currentHour !== 12) hour24 += 12;\n\t\t\t\t\tif (currentPeriod === \"AM\" && currentHour === 12) hour24 = 0;\n\t\t\t\t\thourSelect.value = hour24;\n\t\t\t\t} else {\n\t\t\t\t\tlet hour12 = currentHour > 12 ? currentHour - 12 : currentHour === 0 ? 12 : currentHour;\n\t\t\t\t\tperiodSelect.value = currentHour >= 12 ? \"PM\" : \"AM\";\n\t\t\t\t\thourSelect.value = hour12;\n\t\t\t\t}\n\n\t\t\t\tupdateSummary();\n\t\t\t});\n\t\t});\n\n\t\t// Time change handlers\n\t\thourSelect.addEventListener(\"change\", updateSummary);\n\t\tminuteSelect.addEventListener(\"change\", updateSummary);\n\t\tperiodSelect.addEventListener(\"change\", updateSummary);\n\t}\n\n\t/**\n\t * Trigger scheduled send\n\t * @param {Element} sendButton - Send button element\n\t * @param {Date} scheduledAt - Schedule time\n\t */\n\tfunction triggerScheduledSend(sendButton, scheduledAt) {\n\t\t// Validate schedule time\n\t\tconst validation = validateScheduleDate(scheduledAt);\n\t\tif (!validation.isValid) {\n\t\t\tshowToast(\"Invalid Schedule Time\", validation.error, \"error\");\n\t\t\treturn;\n\t\t}\n\n\t\t// Set pending schedule for API interception\n\t\tState.set(\"pendingScheduledAt\", scheduledAt.toISOString());\n\n\t\tLogger.info(\"Scheduling email for:\", scheduledAt.toISOString());\n\n\t\t// Ensure patches are applied\n\t\tapplyPatches();\n\n\t\t// Click the send button - our patch will intercept the API call\n\t\ttry {\n\t\t\tsendButton.click();\n\t\t} catch (e) {\n\t\t\tLogger.error(\"Error clicking send button:\", e);\n\t\t\tState.set(\"pendingScheduledAt\", null);\n\t\t\tshowToast(\"Error\", \"Failed to initiate send\", \"error\");\n\t\t\treturn;\n\t\t}\n\n\t\t// Clear pending after timeout if the click didn't trigger an API call\n\t\tsetTimeout(() => {\n\t\t\tif (State.get(\"pendingScheduledAt\")) {\n\t\t\t\tLogger.warn(\"Clearing unused pending schedule after timeout\");\n\t\t\t\tState.set(\"pendingScheduledAt\", null);\n\t\t\t}\n\t\t}, 10000);\n\t}\n\n\t// ============================================================\n\t// SIDEBAR INTEGRATION\n\t// ============================================================\n\n\t/**\n\t * Inject scheduled folder into sidebar\n\t * @param {Element} container - Sidebar container\n\t * @param {Element} afterElement - Element to insert after\n\t */\n\tfunction injectScheduledFolder(container, afterElement) {\n\t\t// Prevent double injection\n\t\tif (container.querySelector(\".mail-scheduler-sidebar-item\")) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst scheduledItem = document.createElement(\"div\");\n\t\tscheduledItem.className = \"mail-scheduler-sidebar-item\";\n\t\tscheduledItem.setAttribute(\"role\", \"button\");\n\t\tscheduledItem.setAttribute(\"tabindex\", \"0\");\n\t\tscheduledItem.setAttribute(\"aria-label\", \"Scheduled emails\");\n\t\tscheduledItem.innerHTML = `\n\t\t\t${icons.clock}\n\t\t\t<span>Scheduled</span>\n\t\t\t<span class=\"mail-scheduler-sidebar-count\" id=\"mail-scheduler-count\" aria-live=\"polite\">0</span>\n\t\t`;\n\n\t\t// Insert after drafts\n\t\tif (afterElement.nextSibling) {\n\t\t\tcontainer.insertBefore(scheduledItem, afterElement.nextSibling);\n\t\t} else {\n\t\t\tcontainer.appendChild(scheduledItem);\n\t\t}\n\n\t\t// Click handler\n\t\tconst navigateToScheduled = () => {\n\t\t\tif (typeof frappe !== \"undefined\" && frappe.set_route) {\n\t\t\t\tfrappe.set_route(\"mail\", \"scheduled\");\n\t\t\t} else {\n\t\t\t\twindow.location.hash = \"#/mail/scheduled\";\n\t\t\t}\n\t\t};\n\n\t\tscheduledItem.addEventListener(\"click\", navigateToScheduled);\n\t\tscheduledItem.addEventListener(\"keydown\", (e) => {\n\t\t\tif (e.key === \"Enter\" || e.key === \" \") {\n\t\t\t\te.preventDefault();\n\t\t\t\tnavigateToScheduled();\n\t\t\t}\n\t\t});\n\n\t\t// Load count\n\t\tloadScheduledCount();\n\n\t\tLogger.info(\"Scheduled folder injected into sidebar\");\n\t}\n\n\t/**\n\t * Load scheduled emails count\n\t */\n\tasync function loadScheduledCount() {\n\t\ttry {\n\t\t\tconst response = await frappe.call({\n\t\t\t\tmethod: ENDPOINTS.GET_SCHEDULED,\n\t\t\t\targs: { limit: 1, offset: 0 },\n\t\t\t});\n\n\t\t\tif (response?.message) {\n\t\t\t\tconst count = response.message.total || 0;\n\t\t\t\tState.set(\"scheduledCount\", count);\n\n\t\t\t\tconst countEl = document.getElementById(\"mail-scheduler-count\");\n\t\t\t\tif (countEl) {\n\t\t\t\t\tcountEl.textContent = count;\n\t\t\t\t\tcountEl.style.display = count > 0 ? \"inline-block\" : \"none\";\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tLogger.warn(\"Could not load scheduled count:\", e.message);\n\t\t}\n\t}\n\n\t// Debounced version for frequent calls\n\tconst debouncedLoadScheduledCount = debounce(loadScheduledCount, config.debounce_ms);\n\n\t// ============================================================\n\t// DOM OBSERVERS\n\t// ============================================================\n\n\tlet toolbarObserver = null;\n\tlet sidebarObserver = null;\n\n\t/**\n\t * Check for toolbar and inject button\n\t * @param {Element} root - Root element to search\n\t */\n\tfunction checkAndInjectButton(root) {\n\t\tconst containers = root.querySelectorAll(\".ml-auto.flex.items-center.space-x-2\");\n\t\tLogger.debug(`Found ${containers.length} potential toolbar containers`);\n\n\t\tcontainers.forEach((container) => {\n\t\t\t// Skip if already has schedule button\n\t\t\tif (container.querySelector(\".mail-scheduler-dropdown\")) {\n\t\t\t\tLogger.debug(\"Container already has schedule button, skipping\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Find Send button\n\t\t\tconst buttons = container.querySelectorAll(\"button\");\n\t\t\tLogger.debug(`Found ${buttons.length} buttons in container`);\n\t\t\tlet sendButton = null;\n\n\t\t\tbuttons.forEach((btn) => {\n\t\t\t\tconst text = btn.textContent?.trim();\n\t\t\t\tLogger.debug(`Button text: \"${text}\"`);\n\t\t\t\tif (text === \"Send\" || text.includes(\"Send\")) {\n\t\t\t\t\tsendButton = btn;\n\t\t\t\t\tLogger.debug(\"Matched Send button by text\");\n\t\t\t\t}\n\t\t\t\tif (btn.innerHTML.includes(\"lucide\") && btn.innerHTML.includes(\"send\")) {\n\t\t\t\t\tsendButton = btn;\n\t\t\t\t\tLogger.debug(\"Matched Send button by lucide icon\");\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (sendButton) {\n\t\t\t\tLogger.info(\"Found Send button, injecting Schedule button\");\n\t\t\t\tinjectScheduleButton(container, sendButton);\n\t\t\t} else {\n\t\t\t\tLogger.debug(\"No Send button found in this container\");\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Check and inject sidebar folder\n\t * @param {Element} root - Root element to search\n\t */\n\tfunction checkAndInjectSidebarFolder(root) {\n\t\tconst navSections = root.querySelectorAll(\"nav, aside, [class*='sidebar']\");\n\n\t\tnavSections.forEach((nav) => {\n\t\t\tif (nav.querySelector(\".mail-scheduler-sidebar-item\")) return;\n\n\t\t\tconst links = nav.querySelectorAll(\"a, [role='button'], .cursor-pointer\");\n\t\t\tlet draftsLink = null;\n\t\t\tlet parentContainer = null;\n\n\t\t\tlinks.forEach((link) => {\n\t\t\t\tconst text = link.textContent?.toLowerCase() || \"\";\n\t\t\t\tif (text.includes(\"drafts\") || text.includes(\"draft\")) {\n\t\t\t\t\tdraftsLink = link;\n\t\t\t\t\tparentContainer = link.parentElement;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (draftsLink && parentContainer) {\n\t\t\t\tinjectScheduledFolder(parentContainer, draftsLink);\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Set up DOM observers\n\t */\n\tfunction setupObservers() {\n\t\t// Toolbar observer - watch for changes and check entire body\n\t\ttoolbarObserver = new MutationObserver((mutations) => {\n\t\t\t// Check the entire document whenever there's any mutation\n\t\t\t// This is more reliable for Vue apps where components mount dynamically\n\t\t\tcheckAndInjectButton(document.body);\n\t\t});\n\n\t\ttoolbarObserver.observe(document.body, {\n\t\t\tchildList: true,\n\t\t\tsubtree: true,\n\t\t});\n\n\t\t// Sidebar observer\n\t\tsidebarObserver = new MutationObserver((mutations) => {\n\t\t\t// Check entire document for sidebar changes\n\t\t\tcheckAndInjectSidebarFolder(document.body);\n\t\t});\n\n\t\tsidebarObserver.observe(document.body, {\n\t\t\tchildList: true,\n\t\t\tsubtree: true,\n\t\t});\n\n\t\t// Initial checks\n\t\tconst checkIntervals = [500, 1000, 2000, 5000];\n\t\tcheckIntervals.forEach((delay) => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tcheckAndInjectButton(document.body);\n\t\t\t\tcheckAndInjectSidebarFolder(document.body);\n\t\t\t}, delay);\n\t\t});\n\n\t\tLogger.info(\"DOM observers set up\");\n\t}\n\n\t/**\n\t * Clean up observers\n\t */\n\tfunction cleanupObservers() {\n\t\tif (toolbarObserver) {\n\t\t\ttoolbarObserver.disconnect();\n\t\t\ttoolbarObserver = null;\n\t\t}\n\t\tif (sidebarObserver) {\n\t\t\tsidebarObserver.disconnect();\n\t\t\tsidebarObserver = null;\n\t\t}\n\t\tLogger.debug(\"Observers cleaned up\");\n\t}\n\n\t// ============================================================\n\t// STYLES\n\t// ============================================================\n\n\tfunction addStyles() {\n\t\tif (document.getElementById(\"mail-scheduler-styles\")) return;\n\n\t\tconst style = document.createElement(\"style\");\n\t\tstyle.id = \"mail-scheduler-styles\";\n\t\tstyle.textContent = `\n\t\t\t/* =============================================\n\t\t\t   Mail Scheduler Styles - Enterprise Edition\n\t\t\t   ============================================= */\n\n\t\t\t/* CSS Custom Properties for theming */\n\t\t\t:root {\n\t\t\t\t--ms-primary: #2563eb;\n\t\t\t\t--ms-primary-dark: #1d4ed8;\n\t\t\t\t--ms-primary-light: #eff6ff;\n\t\t\t\t--ms-text: #1f2937;\n\t\t\t\t--ms-text-muted: #6b7280;\n\t\t\t\t--ms-text-light: #9ca3af;\n\t\t\t\t--ms-bg: white;\n\t\t\t\t--ms-bg-light: #f9fafb;\n\t\t\t\t--ms-bg-gray: #f3f4f6;\n\t\t\t\t--ms-border: #e5e7eb;\n\t\t\t\t--ms-shadow: rgba(0, 0, 0, 0.1);\n\t\t\t\t--ms-error: #dc2626;\n\t\t\t\t--ms-success: #16a34a;\n\t\t\t\t--ms-warning: #d97706;\n\t\t\t}\n\n\t\t\t/* Dark mode support */\n\t\t\t@media (prefers-color-scheme: dark) {\n\t\t\t\t:root {\n\t\t\t\t\t--ms-text: #f3f4f6;\n\t\t\t\t\t--ms-text-muted: #9ca3af;\n\t\t\t\t\t--ms-text-light: #6b7280;\n\t\t\t\t\t--ms-bg: #1f2937;\n\t\t\t\t\t--ms-bg-light: #374151;\n\t\t\t\t\t--ms-bg-gray: #4b5563;\n\t\t\t\t\t--ms-border: #4b5563;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/* Schedule Button */\n\t\t\t.mail-scheduler-btn {\n\t\t\t\tdisplay: inline-flex;\n\t\t\t\talign-items: center;\n\t\t\t\tgap: 6px;\n\t\t\t\tpadding: 6px 12px;\n\t\t\t\tfont-size: 14px;\n\t\t\t\tfont-weight: 500;\n\t\t\t\tcolor: var(--ms-text, #1f2937);\n\t\t\t\tbackground: var(--ms-bg, white);\n\t\t\t\tborder: 1px solid var(--ms-border, #e5e7eb);\n\t\t\t\tborder-radius: 8px;\n\t\t\t\tcursor: pointer;\n\t\t\t\ttransition: all 0.15s ease;\n\t\t\t\tuser-select: none;\n\t\t\t}\n\n\t\t\t.mail-scheduler-btn:hover {\n\t\t\t\tbackground: var(--ms-bg-light, #f9fafb);\n\t\t\t\tborder-color: var(--ms-text-muted, #9ca3af);\n\t\t\t}\n\n\t\t\t.mail-scheduler-btn:focus {\n\t\t\t\toutline: 2px solid var(--ms-primary, #2563eb);\n\t\t\t\toutline-offset: 2px;\n\t\t\t}\n\n\t\t\t.mail-scheduler-btn:disabled {\n\t\t\t\topacity: 0.5;\n\t\t\t\tcursor: not-allowed;\n\t\t\t}\n\n\t\t\t.mail-scheduler-btn svg {\n\t\t\t\twidth: 16px;\n\t\t\t\theight: 16px;\n\t\t\t\tflex-shrink: 0;\n\t\t\t}\n\n\t\t\t/* Dropdown Menu */\n\t\t\t.mail-scheduler-dropdown {\n\t\t\t\tposition: relative;\n\t\t\t\tdisplay: inline-block;\n\t\t\t}\n\n\t\t\t.mail-scheduler-menu {\n\t\t\t\tposition: absolute;\n\t\t\t\tbottom: calc(100% + 4px);\n\t\t\t\tright: 0;\n\t\t\t\tmin-width: 220px;\n\t\t\t\tbackground: var(--ms-bg, white);\n\t\t\t\tborder: 1px solid var(--ms-border, #e5e7eb);\n\t\t\t\tborder-radius: 8px;\n\t\t\t\tbox-shadow: 0 10px 15px -3px var(--ms-shadow, rgba(0,0,0,0.1)), \n\t\t\t\t            0 4px 6px -2px var(--ms-shadow, rgba(0,0,0,0.05));\n\t\t\t\tz-index: 99999;\n\t\t\t\tpadding: 4px;\n\t\t\t\topacity: 0;\n\t\t\t\tvisibility: hidden;\n\t\t\t\ttransform: translateY(8px);\n\t\t\t\ttransition: all 0.15s ease;\n\t\t\t}\n\n\t\t\t.mail-scheduler-dropdown.open .mail-scheduler-menu {\n\t\t\t\topacity: 1;\n\t\t\t\tvisibility: visible;\n\t\t\t\ttransform: translateY(0);\n\t\t\t}\n\n\t\t\t.mail-scheduler-menu-item {\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tgap: 10px;\n\t\t\t\tpadding: 10px 12px;\n\t\t\t\tfont-size: 13px;\n\t\t\t\tcolor: var(--ms-text, #374151);\n\t\t\t\tborder-radius: 6px;\n\t\t\t\tcursor: pointer;\n\t\t\t\ttransition: background 0.1s ease;\n\t\t\t}\n\n\t\t\t.mail-scheduler-menu-item:hover,\n\t\t\t.mail-scheduler-menu-item:focus {\n\t\t\t\tbackground: var(--ms-bg-gray, #f3f4f6);\n\t\t\t\toutline: none;\n\t\t\t}\n\n\t\t\t.mail-scheduler-menu-item svg {\n\t\t\t\twidth: 16px;\n\t\t\t\theight: 16px;\n\t\t\t\tcolor: var(--ms-text-muted, #6b7280);\n\t\t\t\tflex-shrink: 0;\n\t\t\t}\n\n\t\t\t.mail-scheduler-menu-item .label {\n\t\t\t\tflex: 1;\n\t\t\t}\n\n\t\t\t.mail-scheduler-menu-item .sublabel {\n\t\t\t\tfont-size: 11px;\n\t\t\t\tcolor: var(--ms-text-light, #9ca3af);\n\t\t\t}\n\n\t\t\t.mail-scheduler-divider {\n\t\t\t\theight: 1px;\n\t\t\t\tbackground: var(--ms-border, #e5e7eb);\n\t\t\t\tmargin: 4px 0;\n\t\t\t}\n\n\t\t\t/* Modal */\n\t\t\t.mail-scheduler-modal-overlay {\n\t\t\t\tposition: fixed;\n\t\t\t\tinset: 0;\n\t\t\t\tbackground: rgba(0, 0, 0, 0.5);\n\t\t\t\tbackdrop-filter: blur(2px);\n\t\t\t\tz-index: 999999;\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tjustify-content: center;\n\t\t\t\topacity: 0;\n\t\t\t\tvisibility: hidden;\n\t\t\t\ttransition: all 0.2s ease;\n\t\t\t}\n\n\t\t\t.mail-scheduler-modal-overlay.open {\n\t\t\t\topacity: 1;\n\t\t\t\tvisibility: visible;\n\t\t\t}\n\n\t\t\t.mail-scheduler-modal {\n\t\t\t\tbackground: var(--ms-bg, white);\n\t\t\t\tborder-radius: 12px;\n\t\t\t\tbox-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n\t\t\t\tmax-width: 420px;\n\t\t\t\twidth: 100%;\n\t\t\t\tmax-height: 90vh;\n\t\t\t\toverflow: auto;\n\t\t\t\ttransform: scale(0.95);\n\t\t\t\ttransition: transform 0.2s ease;\n\t\t\t}\n\n\t\t\t.mail-scheduler-modal-overlay.open .mail-scheduler-modal {\n\t\t\t\ttransform: scale(1);\n\t\t\t}\n\n\t\t\t.mail-scheduler-modal-header {\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tjustify-content: space-between;\n\t\t\t\tpadding: 16px 20px;\n\t\t\t\tborder-bottom: 1px solid var(--ms-border, #e5e7eb);\n\t\t\t}\n\n\t\t\t.mail-scheduler-modal-title {\n\t\t\t\tfont-size: 16px;\n\t\t\t\tfont-weight: 600;\n\t\t\t\tcolor: var(--ms-text, #111827);\n\t\t\t}\n\n\t\t\t.mail-scheduler-modal-close {\n\t\t\t\tpadding: 4px;\n\t\t\t\tborder: none;\n\t\t\t\tbackground: transparent;\n\t\t\t\tborder-radius: 6px;\n\t\t\t\tcursor: pointer;\n\t\t\t\ttransition: background 0.1s ease;\n\t\t\t\tcolor: var(--ms-text-muted, #6b7280);\n\t\t\t}\n\n\t\t\t.mail-scheduler-modal-close:hover,\n\t\t\t.mail-scheduler-modal-close:focus {\n\t\t\t\tbackground: var(--ms-bg-gray, #f3f4f6);\n\t\t\t\toutline: none;\n\t\t\t}\n\n\t\t\t.mail-scheduler-modal-body {\n\t\t\t\tpadding: 20px;\n\t\t\t}\n\n\t\t\t.mail-scheduler-modal-footer {\n\t\t\t\tdisplay: flex;\n\t\t\t\tjustify-content: flex-end;\n\t\t\t\tgap: 8px;\n\t\t\t\tpadding: 16px 20px;\n\t\t\t\tborder-top: 1px solid var(--ms-border, #e5e7eb);\n\t\t\t}\n\n\t\t\t/* Quick Options */\n\t\t\t.mail-scheduler-quick-options {\n\t\t\t\tdisplay: grid;\n\t\t\t\tgrid-template-columns: repeat(3, 1fr);\n\t\t\t\tgap: 8px;\n\t\t\t\tmargin-bottom: 16px;\n\t\t\t}\n\n\t\t\t.mail-scheduler-quick-option {\n\t\t\t\tdisplay: flex;\n\t\t\t\tflex-direction: column;\n\t\t\t\talign-items: center;\n\t\t\t\tpadding: 12px 8px;\n\t\t\t\tborder: 1px solid var(--ms-border, #e5e7eb);\n\t\t\t\tborder-radius: 8px;\n\t\t\t\tcursor: pointer;\n\t\t\t\ttransition: all 0.15s ease;\n\t\t\t\tbackground: var(--ms-bg, white);\n\t\t\t}\n\n\t\t\t.mail-scheduler-quick-option:hover,\n\t\t\t.mail-scheduler-quick-option:focus {\n\t\t\t\tborder-color: var(--ms-primary, #2563eb);\n\t\t\t\tbackground: var(--ms-primary-light, #eff6ff);\n\t\t\t\toutline: none;\n\t\t\t}\n\n\t\t\t.mail-scheduler-quick-option.selected {\n\t\t\t\tborder-color: var(--ms-primary, #2563eb);\n\t\t\t\tbackground: var(--ms-primary-light, #eff6ff);\n\t\t\t}\n\n\t\t\t.mail-scheduler-quick-option svg {\n\t\t\t\twidth: 20px;\n\t\t\t\theight: 20px;\n\t\t\t\tmargin-bottom: 4px;\n\t\t\t\tcolor: var(--ms-text-muted, #6b7280);\n\t\t\t}\n\n\t\t\t.mail-scheduler-quick-option .label {\n\t\t\t\tfont-size: 12px;\n\t\t\t\tfont-weight: 500;\n\t\t\t\tcolor: var(--ms-text, #374151);\n\t\t\t}\n\n\t\t\t.mail-scheduler-quick-option .time {\n\t\t\t\tfont-size: 11px;\n\t\t\t\tcolor: var(--ms-text-muted, #9ca3af);\n\t\t\t}\n\n\t\t\t/* Calendar */\n\t\t\t.mail-scheduler-calendar {\n\t\t\t\tborder: 1px solid var(--ms-border, #e5e7eb);\n\t\t\t\tborder-radius: 8px;\n\t\t\t\tpadding: 12px;\n\t\t\t\tmargin-bottom: 16px;\n\t\t\t}\n\n\t\t\t.mail-scheduler-calendar-header {\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tjustify-content: space-between;\n\t\t\t\tmargin-bottom: 12px;\n\t\t\t}\n\n\t\t\t.mail-scheduler-calendar-nav {\n\t\t\t\tpadding: 4px 8px;\n\t\t\t\tborder: none;\n\t\t\t\tbackground: transparent;\n\t\t\t\tborder-radius: 6px;\n\t\t\t\tcursor: pointer;\n\t\t\t\ttransition: background 0.1s ease;\n\t\t\t\tcolor: var(--ms-text, #374151);\n\t\t\t}\n\n\t\t\t.mail-scheduler-calendar-nav:hover,\n\t\t\t.mail-scheduler-calendar-nav:focus {\n\t\t\t\tbackground: var(--ms-bg-gray, #f3f4f6);\n\t\t\t\toutline: none;\n\t\t\t}\n\n\t\t\t.mail-scheduler-calendar-month {\n\t\t\t\tfont-weight: 600;\n\t\t\t\tfont-size: 14px;\n\t\t\t\tcolor: var(--ms-text, #374151);\n\t\t\t}\n\n\t\t\t.mail-scheduler-calendar-weekdays {\n\t\t\t\tdisplay: grid;\n\t\t\t\tgrid-template-columns: repeat(7, 1fr);\n\t\t\t\tgap: 2px;\n\t\t\t\tmargin-bottom: 4px;\n\t\t\t}\n\n\t\t\t.mail-scheduler-calendar-weekday {\n\t\t\t\ttext-align: center;\n\t\t\t\tfont-size: 11px;\n\t\t\t\tfont-weight: 500;\n\t\t\t\tcolor: var(--ms-text-muted, #9ca3af);\n\t\t\t\tpadding: 4px;\n\t\t\t}\n\n\t\t\t.mail-scheduler-calendar-days {\n\t\t\t\tdisplay: grid;\n\t\t\t\tgrid-template-columns: repeat(7, 1fr);\n\t\t\t\tgap: 2px;\n\t\t\t}\n\n\t\t\t.mail-scheduler-calendar-day {\n\t\t\t\taspect-ratio: 1;\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tjustify-content: center;\n\t\t\t\tfont-size: 13px;\n\t\t\t\tborder-radius: 50%;\n\t\t\t\ttransition: all 0.1s ease;\n\t\t\t\tcolor: var(--ms-text, #374151);\n\t\t\t}\n\n\t\t\t.mail-scheduler-calendar-day:hover:not(.disabled):not(.other-month) {\n\t\t\t\tbackground: var(--ms-bg-gray, #f3f4f6);\n\t\t\t}\n\n\t\t\t.mail-scheduler-calendar-day:focus:not(.disabled):not(.other-month) {\n\t\t\t\toutline: 2px solid var(--ms-primary, #2563eb);\n\t\t\t\toutline-offset: 2px;\n\t\t\t}\n\n\t\t\t.mail-scheduler-calendar-day.other-month {\n\t\t\t\tcolor: var(--ms-text-light, #d1d5db);\n\t\t\t}\n\n\t\t\t.mail-scheduler-calendar-day.today {\n\t\t\t\tfont-weight: 700;\n\t\t\t\tcolor: var(--ms-primary, #2563eb);\n\t\t\t}\n\n\t\t\t.mail-scheduler-calendar-day.selected {\n\t\t\t\tbackground: var(--ms-primary, #2563eb) !important;\n\t\t\t\tcolor: white !important;\n\t\t\t}\n\n\t\t\t.mail-scheduler-calendar-day.disabled {\n\t\t\t\tcolor: var(--ms-text-light, #d1d5db);\n\t\t\t\tcursor: not-allowed;\n\t\t\t}\n\n\t\t\t/* Time Picker */\n\t\t\t.mail-scheduler-time {\n\t\t\t\tmargin-bottom: 16px;\n\t\t\t}\n\n\t\t\t.mail-scheduler-time-header {\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tjustify-content: space-between;\n\t\t\t\tmargin-bottom: 8px;\n\t\t\t}\n\n\t\t\t.mail-scheduler-time-label {\n\t\t\t\tfont-size: 13px;\n\t\t\t\tfont-weight: 500;\n\t\t\t\tcolor: var(--ms-text, #374151);\n\t\t\t}\n\n\t\t\t.mail-scheduler-time-format {\n\t\t\t\tdisplay: flex;\n\t\t\t\tgap: 4px;\n\t\t\t}\n\n\t\t\t.mail-scheduler-time-format button {\n\t\t\t\tpadding: 2px 8px;\n\t\t\t\tfont-size: 11px;\n\t\t\t\tborder-radius: 4px;\n\t\t\t\tborder: none;\n\t\t\t\tcursor: pointer;\n\t\t\t\ttransition: all 0.1s ease;\n\t\t\t\tbackground: transparent;\n\t\t\t\tcolor: var(--ms-text-muted, #6b7280);\n\t\t\t}\n\n\t\t\t.mail-scheduler-time-format button:hover,\n\t\t\t.mail-scheduler-time-format button:focus {\n\t\t\t\tbackground: var(--ms-bg-gray, #e5e7eb);\n\t\t\t\toutline: none;\n\t\t\t}\n\n\t\t\t.mail-scheduler-time-format button.active {\n\t\t\t\tbackground: var(--ms-bg-gray, #e5e7eb);\n\t\t\t\tcolor: var(--ms-text, #374151);\n\t\t\t}\n\n\t\t\t.mail-scheduler-time-inputs {\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tgap: 8px;\n\t\t\t}\n\n\t\t\t.mail-scheduler-time-inputs select {\n\t\t\t\tflex: 1;\n\t\t\t\tpadding: 8px 12px;\n\t\t\t\tfont-size: 14px;\n\t\t\t\tborder: 1px solid var(--ms-border, #e5e7eb);\n\t\t\t\tborder-radius: 8px;\n\t\t\t\tbackground: var(--ms-bg, white);\n\t\t\t\tcolor: var(--ms-text, #374151);\n\t\t\t\tcursor: pointer;\n\t\t\t}\n\n\t\t\t.mail-scheduler-time-inputs select:focus {\n\t\t\t\toutline: none;\n\t\t\t\tborder-color: var(--ms-primary, #2563eb);\n\t\t\t\tbox-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);\n\t\t\t}\n\n\t\t\t.mail-scheduler-time-separator {\n\t\t\t\tfont-weight: 600;\n\t\t\t\tcolor: var(--ms-text-muted, #9ca3af);\n\t\t\t}\n\n\t\t\t.hidden {\n\t\t\t\tdisplay: none !important;\n\t\t\t}\n\n\t\t\t/* Summary */\n\t\t\t.mail-scheduler-summary {\n\t\t\t\tbackground: var(--ms-bg-light, #f9fafb);\n\t\t\t\tborder-radius: 8px;\n\t\t\t\tpadding: 12px;\n\t\t\t\tdisplay: flex;\n\t\t\t\tgap: 12px;\n\t\t\t}\n\n\t\t\t.mail-scheduler-summary svg {\n\t\t\t\twidth: 20px;\n\t\t\t\theight: 20px;\n\t\t\t\tcolor: var(--ms-primary, #2563eb);\n\t\t\t\tflex-shrink: 0;\n\t\t\t}\n\n\t\t\t.mail-scheduler-summary-text {\n\t\t\t\tfont-size: 13px;\n\t\t\t\tcolor: var(--ms-text-muted, #6b7280);\n\t\t\t}\n\n\t\t\t.mail-scheduler-summary-date {\n\t\t\t\tfont-weight: 600;\n\t\t\t\tcolor: var(--ms-text, #111827);\n\t\t\t\tmargin-top: 2px;\n\t\t\t}\n\n\t\t\t.mail-scheduler-summary-relative {\n\t\t\t\tfont-size: 12px;\n\t\t\t\tcolor: var(--ms-text-muted, #9ca3af);\n\t\t\t\tmargin-top: 4px;\n\t\t\t}\n\n\t\t\t.mail-scheduler-summary-relative.error {\n\t\t\t\tcolor: var(--ms-error, #dc2626);\n\t\t\t}\n\n\t\t\t/* Buttons */\n\t\t\t.mail-scheduler-btn-primary {\n\t\t\t\tdisplay: inline-flex;\n\t\t\t\talign-items: center;\n\t\t\t\tgap: 6px;\n\t\t\t\tpadding: 8px 16px;\n\t\t\t\tfont-size: 14px;\n\t\t\t\tfont-weight: 500;\n\t\t\t\tcolor: white;\n\t\t\t\tbackground: var(--ms-primary, #2563eb);\n\t\t\t\tborder: none;\n\t\t\t\tborder-radius: 8px;\n\t\t\t\tcursor: pointer;\n\t\t\t\ttransition: all 0.15s ease;\n\t\t\t}\n\n\t\t\t.mail-scheduler-btn-primary:hover {\n\t\t\t\tbackground: var(--ms-primary-dark, #1d4ed8);\n\t\t\t}\n\n\t\t\t.mail-scheduler-btn-primary:focus {\n\t\t\t\toutline: 2px solid var(--ms-primary, #2563eb);\n\t\t\t\toutline-offset: 2px;\n\t\t\t}\n\n\t\t\t.mail-scheduler-btn-primary:disabled {\n\t\t\t\topacity: 0.5;\n\t\t\t\tcursor: not-allowed;\n\t\t\t}\n\n\t\t\t.mail-scheduler-btn-primary svg {\n\t\t\t\twidth: 16px;\n\t\t\t\theight: 16px;\n\t\t\t}\n\n\t\t\t.mail-scheduler-btn-secondary {\n\t\t\t\tdisplay: inline-flex;\n\t\t\t\talign-items: center;\n\t\t\t\tgap: 6px;\n\t\t\t\tpadding: 8px 16px;\n\t\t\t\tfont-size: 14px;\n\t\t\t\tfont-weight: 500;\n\t\t\t\tcolor: var(--ms-text, #374151);\n\t\t\t\tbackground: var(--ms-bg, white);\n\t\t\t\tborder: 1px solid var(--ms-border, #e5e7eb);\n\t\t\t\tborder-radius: 8px;\n\t\t\t\tcursor: pointer;\n\t\t\t\ttransition: all 0.15s ease;\n\t\t\t}\n\n\t\t\t.mail-scheduler-btn-secondary:hover {\n\t\t\t\tbackground: var(--ms-bg-light, #f9fafb);\n\t\t\t}\n\n\t\t\t.mail-scheduler-btn-secondary:focus {\n\t\t\t\toutline: 2px solid var(--ms-primary, #2563eb);\n\t\t\t\toutline-offset: 2px;\n\t\t\t}\n\n\t\t\t/* Sidebar Scheduled Folder */\n\t\t\t.mail-scheduler-sidebar-item {\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tgap: 8px;\n\t\t\t\tpadding: 8px 12px;\n\t\t\t\tmargin: 2px 8px;\n\t\t\t\tborder-radius: 8px;\n\t\t\t\tcursor: pointer;\n\t\t\t\ttransition: all 0.15s ease;\n\t\t\t\tcolor: var(--ms-text, #374151);\n\t\t\t\tfont-size: 14px;\n\t\t\t}\n\n\t\t\t.mail-scheduler-sidebar-item:hover,\n\t\t\t.mail-scheduler-sidebar-item:focus {\n\t\t\t\tbackground: var(--ms-bg-gray, #f3f4f6);\n\t\t\t\toutline: none;\n\t\t\t}\n\n\t\t\t.mail-scheduler-sidebar-item.active {\n\t\t\t\tbackground: var(--ms-primary-light, #eff6ff);\n\t\t\t\tcolor: var(--ms-primary, #2563eb);\n\t\t\t}\n\n\t\t\t.mail-scheduler-sidebar-item svg {\n\t\t\t\twidth: 18px;\n\t\t\t\theight: 18px;\n\t\t\t\tflex-shrink: 0;\n\t\t\t}\n\n\t\t\t.mail-scheduler-sidebar-count {\n\t\t\t\tmargin-left: auto;\n\t\t\t\tbackground: var(--ms-bg-gray, #e5e7eb);\n\t\t\t\tcolor: var(--ms-text-muted, #6b7280);\n\t\t\t\tpadding: 2px 8px;\n\t\t\t\tborder-radius: 12px;\n\t\t\t\tfont-size: 12px;\n\t\t\t\tfont-weight: 500;\n\t\t\t\tmin-width: 20px;\n\t\t\t\ttext-align: center;\n\t\t\t}\n\n\t\t\t/* Scheduled Badge */\n\t\t\t.mail-scheduler-badge {\n\t\t\t\tdisplay: inline-flex;\n\t\t\t\talign-items: center;\n\t\t\t\tgap: 4px;\n\t\t\t\tpadding: 2px 8px;\n\t\t\t\tbackground: #fef3c7;\n\t\t\t\tcolor: #92400e;\n\t\t\t\tborder-radius: 9999px;\n\t\t\t\tfont-size: 11px;\n\t\t\t\tfont-weight: 500;\n\t\t\t}\n\n\t\t\t/* Fallback Toast */\n\t\t\t.mail-scheduler-toast {\n\t\t\t\tposition: fixed;\n\t\t\t\tbottom: 20px;\n\t\t\t\tright: 20px;\n\t\t\t\tpadding: 12px 20px;\n\t\t\t\tborder-radius: 8px;\n\t\t\t\tbackground: var(--ms-bg, white);\n\t\t\t\tborder: 1px solid var(--ms-border, #e5e7eb);\n\t\t\t\tbox-shadow: 0 10px 15px -3px var(--ms-shadow, rgba(0,0,0,0.1));\n\t\t\t\tz-index: 9999999;\n\t\t\t\topacity: 0;\n\t\t\t\ttransform: translateY(10px);\n\t\t\t\ttransition: all 0.3s ease;\n\t\t\t}\n\n\t\t\t.mail-scheduler-toast.show {\n\t\t\t\topacity: 1;\n\t\t\t\ttransform: translateY(0);\n\t\t\t}\n\n\t\t\t.mail-scheduler-toast-success {\n\t\t\t\tborder-left: 4px solid var(--ms-success, #16a34a);\n\t\t\t}\n\n\t\t\t.mail-scheduler-toast-error {\n\t\t\t\tborder-left: 4px solid var(--ms-error, #dc2626);\n\t\t\t}\n\n\t\t\t.mail-scheduler-toast-warning {\n\t\t\t\tborder-left: 4px solid var(--ms-warning, #d97706);\n\t\t\t}\n\n\t\t\t.mail-scheduler-toast strong {\n\t\t\t\tdisplay: block;\n\t\t\t\tcolor: var(--ms-text, #374151);\n\t\t\t\tmargin-bottom: 4px;\n\t\t\t}\n\n\t\t\t.mail-scheduler-toast span {\n\t\t\t\tfont-size: 13px;\n\t\t\t\tcolor: var(--ms-text-muted, #6b7280);\n\t\t\t}\n\n\t\t\t/* Reduced motion support */\n\t\t\t@media (prefers-reduced-motion: reduce) {\n\t\t\t\t.mail-scheduler-modal-overlay,\n\t\t\t\t.mail-scheduler-modal,\n\t\t\t\t.mail-scheduler-menu,\n\t\t\t\t.mail-scheduler-btn,\n\t\t\t\t.mail-scheduler-toast {\n\t\t\t\t\ttransition: none;\n\t\t\t\t}\n\t\t\t}\n\t\t`;\n\n\t\tdocument.head.appendChild(style);\n\t\tLogger.debug(\"Styles injected\");\n\t}\n\n\t// ============================================================\n\t// PUBLIC API\n\t// ============================================================\n\n\tfunction exposeApi() {\n\t\twindow.mailScheduler = {\n\t\t\tversion: VERSION,\n\t\t\tconfig: { ...config },\n\n\t\t\t// Core methods\n\t\t\tformatScheduledDate,\n\t\t\tvalidateScheduleDate,\n\n\t\t\tgetMaxScheduleDate: () => {\n\t\t\t\tconst maxDate = new Date();\n\t\t\t\tmaxDate.setDate(maxDate.getDate() + config.max_schedule_days);\n\t\t\t\treturn maxDate;\n\t\t\t},\n\n\t\t\t// API methods with proper error handling\n\t\t\tscheduleEmail: async (mailData, scheduledAt) => {\n\t\t\t\tconst validation = validateScheduleDate(new Date(scheduledAt));\n\t\t\t\tif (!validation.isValid) {\n\t\t\t\t\tthrow new Error(validation.error);\n\t\t\t\t}\n\n\t\t\t\tif (isRateLimited()) {\n\t\t\t\t\tthrow new Error(\"Rate limited. Please try again.\");\n\t\t\t\t}\n\n\t\t\t\trecordRequest();\n\n\t\t\t\treturn frappe.call({\n\t\t\t\t\tmethod: ENDPOINTS.CREATE_MAIL,\n\t\t\t\t\targs: { ...mailData, scheduled_at: scheduledAt },\n\t\t\t\t});\n\t\t\t},\n\n\t\t\tcancelScheduledEmail: async (emailId) => {\n\t\t\t\tif (!emailId) {\n\t\t\t\t\tthrow new Error(\"Email ID is required\");\n\t\t\t\t}\n\n\t\t\t\tif (isRateLimited()) {\n\t\t\t\t\tthrow new Error(\"Rate limited. Please try again.\");\n\t\t\t\t}\n\n\t\t\t\trecordRequest();\n\n\t\t\t\treturn frappe.call({\n\t\t\t\t\tmethod: ENDPOINTS.CANCEL_SCHEDULED,\n\t\t\t\t\targs: { email_id: emailId },\n\t\t\t\t});\n\t\t\t},\n\n\t\t\tgetScheduledEmails: async (limit = 20, offset = 0) => {\n\t\t\t\treturn frappe.call({\n\t\t\t\t\tmethod: ENDPOINTS.GET_SCHEDULED,\n\t\t\t\t\targs: {\n\t\t\t\t\t\tlimit: Math.min(Math.max(limit, 1), 100),\n\t\t\t\t\t\toffset: Math.max(offset, 0),\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t},\n\n\t\t\trescheduleEmail: async (emailId, newScheduledAt) => {\n\t\t\t\tif (!emailId) {\n\t\t\t\t\tthrow new Error(\"Email ID is required\");\n\t\t\t\t}\n\n\t\t\t\tconst validation = validateScheduleDate(new Date(newScheduledAt));\n\t\t\t\tif (!validation.isValid) {\n\t\t\t\t\tthrow new Error(validation.error);\n\t\t\t\t}\n\n\t\t\t\tif (isRateLimited()) {\n\t\t\t\t\tthrow new Error(\"Rate limited. Please try again.\");\n\t\t\t\t}\n\n\t\t\t\trecordRequest();\n\n\t\t\t\treturn frappe.call({\n\t\t\t\t\tmethod: ENDPOINTS.RESCHEDULE,\n\t\t\t\t\targs: { email_id: emailId, scheduled_at: newScheduledAt },\n\t\t\t\t});\n\t\t\t},\n\n\t\t\trefreshCount: debouncedLoadScheduledCount,\n\n\t\t\t// For testing/debugging\n\t\t\t_debug: {\n\t\t\t\tgetState: () => ({ ...State._state }),\n\t\t\t\tgetConfig: () => ({ ...config }),\n\t\t\t\tisRateLimited,\n\t\t\t\tapplyPatches,\n\t\t\t\tremovePatches,\n\t\t\t\tLogger,\n\t\t\t},\n\t\t};\n\n\t\tLogger.info(`API exposed at window.mailScheduler (v${VERSION})`);\n\t}\n\n\t// ============================================================\n\t// SVG ICONS\n\t// ============================================================\n\n\tconst icons = {\n\t\tclock: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><circle cx=\"12\" cy=\"12\" r=\"10\"/><polyline points=\"12 6 12 12 16 14\"/></svg>`,\n\t\tchevronUp: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"m18 15-6-6-6 6\"/></svg>`,\n\t\tchevronLeft: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"m15 18-6-6 6-6\"/></svg>`,\n\t\tchevronRight: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"m9 18 6-6-6-6\"/></svg>`,\n\t\tsunrise: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M12 2v8\"/><path d=\"m4.93 10.93 1.41 1.41\"/><path d=\"M2 18h2\"/><path d=\"M20 18h2\"/><path d=\"m19.07 10.93-1.41 1.41\"/><path d=\"M22 22H2\"/><path d=\"m8 6 4-4 4 4\"/><path d=\"M16 18a4 4 0 0 0-8 0\"/></svg>`,\n\t\tsun: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><circle cx=\"12\" cy=\"12\" r=\"4\"/><path d=\"M12 2v2\"/><path d=\"M12 20v2\"/><path d=\"m4.93 4.93 1.41 1.41\"/><path d=\"m17.66 17.66 1.41 1.41\"/><path d=\"M2 12h2\"/><path d=\"M20 12h2\"/><path d=\"m6.34 17.66-1.41 1.41\"/><path d=\"m19.07 4.93-1.41 1.41\"/></svg>`,\n\t\tcalendar: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M8 2v4\"/><path d=\"M16 2v4\"/><rect width=\"18\" height=\"18\" x=\"3\" y=\"4\" rx=\"2\"/><path d=\"M3 10h18\"/></svg>`,\n\t\tsend: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z\"/><path d=\"m21.854 2.147-10.94 10.939\"/></svg>`,\n\t\tx: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><path d=\"M18 6 6 18\"/><path d=\"m6 6 12 12\"/></svg>`,\n\t};\n\n\t// ============================================================\n\t// INITIALIZATION\n\t// ============================================================\n\n\tfunction init() {\n\t\tif (!config.enabled) {\n\t\t\tLogger.info(\"Mail Scheduler is disabled by configuration\");\n\t\t\treturn;\n\t\t}\n\n\t\tif (State.get(\"isInitialized\")) {\n\t\t\tLogger.debug(\"Already initialized, skipping\");\n\t\t\treturn;\n\t\t}\n\n\t\tLogger.info(`Initializing Mail Scheduler v${VERSION}...`);\n\n\t\ttry {\n\t\t\t// Inject styles\n\t\t\taddStyles();\n\n\t\t\t// Set up DOM observers\n\t\t\tsetupObservers();\n\n\t\t\t// Apply API patches\n\t\t\tapplyPatches();\n\n\t\t\t// Expose public API\n\t\t\texposeApi();\n\n\t\t\tState.set(\"isInitialized\", true);\n\t\t\tLogger.info(\"Mail Scheduler initialized successfully\");\n\t\t} catch (e) {\n\t\t\tLogger.error(\"Failed to initialize Mail Scheduler:\", e);\n\t\t}\n\t}\n\n\t// Cleanup on page unload\n\tfunction cleanup() {\n\t\tLogger.debug(\"Cleaning up...\");\n\t\tcleanupObservers();\n\t\tremovePatches();\n\t\tState.reset();\n\t}\n\n\t// Initialize when DOM is ready\n\tif (document.readyState === \"loading\") {\n\t\tdocument.addEventListener(\"DOMContentLoaded\", init);\n\t} else {\n\t\t// Small delay to ensure frappe is loaded\n\t\tsetTimeout(init, 100);\n\t}\n\n\t// Also initialize on frappe ready if available\n\tif (typeof frappe !== \"undefined\" && frappe.ready) {\n\t\tfrappe.ready(init);\n\t}\n\n\t// Cleanup on page unload\n\twindow.addEventListener(\"beforeunload\", cleanup);\n\twindow.addEventListener(\"unload\", cleanup);\n})();\n"],
  "mappings": "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AAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IA8oBpB,SAA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",
  "names": ["_a", "_b", "_c", "VERSION", "schedulerConfig", "config", "ENDPOINTS", "rateLimiter", "Logger", "level", "args", "timestamp", "error", "context", "sanitizeHTML", "str", "div", "debounce", "func", "wait", "timeout", "later", "isRateLimited", "now", "time", "recordRequest", "validateScheduleDate", "date", "minTime", "maxTime", "retryWithBackoff", "fn", "maxAttempts", "delayMs", "lastError", "attempt", "backoffDelay", "resolve", "formatScheduledDate", "d", "e", "getRelativeTime", "diff", "minutes", "hours", "days", "remainingMinutes", "State", "key", "value", "oldValue", "callback", "cb", "newValue", "originalFetch", "originalFrappeCall", "patchFetch", "url", "options", "pendingScheduledAt", "urlStr", "isCreateCall", "isUpdateCall", "body", "parseError", "newEndpoint", "newUrl", "scheduledAt", "newOptions", "__spreadProps", "__spreadValues", "response", "resp", "showToast", "loadScheduledCount", "errorData", "errorMsg", "patchFrappeCall", "opts", "method", "newOpts", "originalCallback", "originalError", "msg", "applyPatches", "removePatches", "title", "message", "type", "indicatorMap", "toast", "getQuickOptionDate", "action", "tomorrow", "monday", "daysUntilMonday", "getQuickOptionLabel", "createDropdownHTML", "icons", "injectScheduleButton", "container", "sendButton", "dropdown", "btn", "menu", "isOpen", "firstItem", "items", "currentIndex", "closeHandler", "item", "openScheduleModal", "validation", "triggerScheduledSend", "existing", "overlay", "createModalHTML", "focusableElements", "firstFocusable", "lastFocusable", "closeModal", "initializeModal", "timeFormat", "modal", "monthLabel", "daysContainer", "hourSelect", "minuteSelect", "periodSelect", "summaryDate", "summaryRelative", "currentMonth", "currentYear", "selectedDate", "populateHours", "i", "option", "renderCalendar", "months", "firstDay", "lastDay", "startPadding", "today", "maxDate", "html", "prevMonthLast", "isPast", "isTooFar", "isToday", "isSelected", "classes", "disabled", "ariaLabel", "remaining", "day", "updateSummary", "highlightQuickOption", "getSelectedDateTime", "hour", "minute", "opt", "optDate", "selected", "matches", "handler", "newFormat", "currentHour", "currentPeriod", "b", "isActive", "hour24", "hour12", "injectScheduledFolder", "afterElement", "scheduledItem", "navigateToScheduled", "count", "countEl", "debouncedLoadScheduledCount", "toolbarObserver", "sidebarObserver", "checkAndInjectButton", "root", "containers", "buttons", "text", "checkAndInjectSidebarFolder", "nav", "links", "draftsLink", "parentContainer", "link", "setupObservers", "mutations", "delay", "cleanupObservers", "addStyles", "style", "exposeApi", "mailData", "emailId", "limit", "offset", "newScheduledAt", "init", "cleanup"]
}
